<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>ACCUMARRAYSET
      - Overload ACCUMARRAY.</title>
    <meta name="generator" content="MATLAB 7.11">
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
    <meta name="DC.date" content="2011-07-11">
    <meta name="DC.source" content="accumarrayset.m">
    <style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style>
  </head>
  <body>
    <div class="content">
      <h1>ACCUMARRAYSET - Overload <tt>ACCUMARRAY</tt>.</h1>
      <!--introduction--><!--/introduction-->
      <h2>Contents</h2>
      <div>
        <ul>
          <li><a href="#1">Description</a></li>
          <li><a href="#2">Syntax</a></li>
          <li><a href="#3">Inputs</a></li>
          <li><a href="#4">Outputs</a></li>
          <li><a href="#5">Credit</a></li>
          <li><a href="#6">See also</a></li>
          <li><a href="#7">Function implementation</a></li>
        </ul>
      </div>
      <h2>Description<a name="1"></a></h2>
      <p>Group elements from a data vector set as they share a same
        index. Fast version of <tt>ACCUMARRAY(subs, val, [], @(x){x})</tt>.</p>
      <h2>Syntax<a name="2"></a></h2>
      <pre>   A = accumarrayset(subs);
   [A, T] = accumarrayset(subs, val);
   [A, T] = accumarrayset(subs, val, spar);</pre>
      <h2>Inputs<a name="3"></a></h2>
      <p><b><tt>subs, val</tt></b> : the position of an element in the
        vector <tt>subs</tt> determines which value of the vector <tt>vals</tt>
        it selects for the accumulated vector; the value of an element
        in <tt>subs</tt> determines the position of the accumulated
        vector in the output; see function <tt>ACCUMARRAY</tt>; <tt>val</tt>
        is optional, in the case it is not passed the vector <tt>(1:numel(subs))</tt>
        is used by default.</p>
      <p><b><tt>spar</tt></b> : (optional) logical flag defining if the
        output cell array <tt>A</tt> (see below) should contain empty
        cells; when set to <tt>true</tt>, only those indices found in <tt>subs</tt>
        are represented in the final output; which ones are represented
        is given in the vector <tt>T</tt>; default: <tt>spar=true</tt>.</p>
      <h2>Outputs<a name="4"></a></h2>
      <p><b><tt>A</tt></b> : cell array grouping values of <tt>val</tt>
        with same index in <tt>subs</tt>.</p>
      <p><b><tt>T</tt></b> : sparse matrix giving for each (unique)
        value/entry found in <tt>subs</tt> the position (index) in the
        cell <tt>A</tt> of the set grouping the corresponding elements
        in <tt>val</tt>; <tt>T</tt> is output when the variable <tt>spar</tt>
        is set to <tt>true</tt>.</p>
      <h2>See also<a name="6"></a></h2>
      <p>Related: <a href="matlab:webpub%28whichpath%28%27ACCUMARRAY%27%29%29"><tt>ACCUMARRAY</tt></a>.
        Called: <a href="MAT2RC.html"><tt>MAT2RC</tt></a>. <a href="matlab:webpub%28whichpath%28%27SORT%27%29%29"><tt>SORT</tt></a>,
        <a href="matlab:webpub%28whichpath%28%27FIND%27%29%29"><tt>FIND</tt></a>,
        <a href="matlab:webpub%28whichpath%28%27DIFF%27%29%29"><tt>DIFF</tt></a>,
        <a href="matlab:webpub%28whichpath%28%27SPARSE%27%29%29"><tt>SPARSE</tt></a>.</p>
      <h2>Function implementation<a name="7"></a></h2>
      <pre class="codeinput"><span class="keyword">function</span> [A, T] = accumarrayset(subs, val, spar)

<span class="keyword">if</span> nargin&lt;3,  spar = false;
    <span class="keyword">if</span> nargin&lt;2,  val = [];  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">if</span> isempty(val),  val = (1:numel(subs))';  <span
class="keyword">end</span>
subs = mat2rc(subs,<span class="string">'c'</span>);  val = mat2rc(val,<span
class="string">'c'</span>);
<span class="comment">% tic</span>
<span class="comment">% A = accumarray(subs, val, [], @(x){x});</span>
<span class="comment">% toc</span>

<span class="comment">%tic</span>
[r,c] = size(subs);
L = zeros(r,1);
L(:) = val; <span class="comment">% (1:r);</span>
L = L(:,ones(1,c));
[T,idx] = sort(subs(:)); <span class="comment">% we need T for finding rows</span>
L = L(idx);
idx = [0; find(diff(T)); numel(T)]; <span class="comment">% run length encoding</span>
T = T(idx(2:end));
t = numel(T);
<span class="keyword">if</span> spar
    A = cell(t, 1);
    <span class="keyword">for</span> ii = 1:t
        A{ii} = L(idx(ii)+1:idx(ii+1));
    <span class="keyword">end</span>
    T = sparse(T,ones(size(T)),1:t,T(end),1);
<span class="keyword">else</span>
    A = cell(T(end), 1);
    <span class="comment">% create same look up table as ACCUMARRAY does</span>
    <span class="keyword">for</span> ii = 1:t
        A{T(ii)} = L(idx(ii)+1:idx(ii+1));
    <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="comment">% toc</span>

<span class="keyword">end</span> <span class="comment">% end of accumarrayset</span>
</pre>
    </div>
    <!--##### SOURCE BEGIN #####
%% ACCUMARRAYSET - Overload |ACCUMARRAY|.%
%% Description% Group elements from a data vector set as they share a same index. Fast
% version of |ACCUMARRAY(subs, val, [], @(x){x})|.%
%% Syntax%     A = accumarrayset(subs);
%     [A, T] = accumarrayset(subs, val);%     [A, T] = accumarrayset(subs, val, spar);
%%% Inputs
% *|subs, val|* : the position of an element in the vector |subs| determines%     which value of the vector |vals| it selects for the accumulated vector;
%     the value of an element in |subs| determines the position of the%     accumulated vector in the output; see function |ACCUMARRAY|; |val| is
%     optional, in the case it is not passed the vector |(1:numel(subs))| is%     used by default.
%% *|spar|* : (optional) logical flag defining if the output cell array |A| 
%     (see below) should contain empty cells; when set to |true|, only those %     indices found in |subs| are represented in the final output; which ones
%     are represented is given in the vector |T|; default: |spar=true|.%
%% Outputs% *|A|* : cell array grouping values of |val| with same index in |subs|.
%% *|T|* : sparse matrix giving for each (unique) value/entry found in |subs|
%     the position (index) in the cell |A| of the set grouping the corresponding %     elements in |val|; |T| is output when the variable |spar| is set to 
%     |true|. % 
%% Credit% <mailto:grazzja@lanl.gov J.Grazzini> (ISR-2/LANL)
%%% See also
% Related:% <matlab:webpub(whichpath('ACCUMARRAY')) |ACCUMARRAY|>.
% Called:% <MAT2RC.html |MAT2RC|>.
% <matlab:webpub(whichpath('SORT')) |SORT|>,% <matlab:webpub(whichpath('FIND')) |FIND|>,
% <matlab:webpub(whichpath('DIFF')) |DIFF|>,% <matlab:webpub(whichpath('SPARSE')) |SPARSE|>.
%% Function implementation
function [A, T] = accumarrayset(subs, val, spar)if nargin<3,  spar = false;
    if nargin<2,  val = [];  endend
if isempty(val),  val = (1:numel(subs))';  end
subs = mat2rc(subs,'c');  val = mat2rc(val,'c');% tic
% A = accumarray(subs, val, [], @(x){x});% toc
%tic
[r,c] = size(subs);L = zeros(r,1);
L(:) = val; % (1:r);L = L(:,ones(1,c));
[T,idx] = sort(subs(:)); % we need T for finding rowsL = L(idx);
idx = [0; find(diff(T)); numel(T)]; % run length encodingT = T(idx(2:end));
t = numel(T);if spar
    A = cell(t, 1);    for ii = 1:t
        A{ii} = L(idx(ii)+1:idx(ii+1));    end
    T = sparse(T,ones(size(T)),1:t,T(end),1);else
    A = cell(T(end), 1);    % create same look up table as ACCUMARRAY does
    for ii = 1:t        A{T(ii)} = L(idx(ii)+1:idx(ii+1));
    endend
% tocend % end of accumarrayset
##### SOURCE END #####-->
  </body>
</html>
