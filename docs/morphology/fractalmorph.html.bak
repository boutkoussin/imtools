<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>  <head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">    <!--This HTML was auto-generated from MATLAB code.To make changes, update the MATLAB code and republish this document.      -->    <title>FRACTALMORPH</title>    <meta name="generator" content="MATLAB 7.14">    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">    <meta name="DC.date" content="2012-05-31">    <meta name="DC.source" content="fractalmorph.m">    <style type="text/css">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}html { min-height:100%; margin-bottom:1px; }html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }html body td { vertical-align:top; text-align:left; }h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }a { color:#005fce; text-decoration:none; }a:hover { color:#005fce; text-decoration:underline; }a:visited { color:#004aa0; text-decoration:none; }p { padding:0px; margin:0px 0px 20px; }img { padding:0px; margin:0px 0px 20px; border:none; }p img, pre img, tt img, li img { margin-bottom:0px; } ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }ul li { padding:0px; margin:0px 0px 7px 0px; }ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }ul li ol li { list-style:decimal; }ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }ol li ol li { list-style-type:lower-alpha; }ol li ul { padding-top:7px; }ol li ul li { list-style:square; }.content { font-size:1.2em; line-height:140%; padding: 20px; }pre, tt, code { font-size:12px; }pre { margin:0px 0px 20px; }pre.error { color:red; }pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }span.keyword { color:#0000FF }span.comment { color:#228B22 }span.string { color:#A020F0 }span.untermstring { color:#B20000 }span.syscmd { color:#B28C00 }.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }.footer p { margin:0px; }  </style>  </head>  <body>    <div class="content">      <h1>FRACTALMORPH</h1>      <!--introduction--><!--/introduction-->      <h2>Contents</h2>      <div>        <ul>          <li><a href="#1">Syntax</a></li>          <li><a href="#3">See also</a></li>          <li><a href="#4">Function implementation</a></li>        </ul>      </div>      <h2>Syntax<a name="1"></a></h2>      <pre>     S = FRACTALMORPH(I);</pre>      <h2>See also<a name="3"></a></h2>      <p>Related: <a href="../../fractal/mftensor/html/FRACTALWAVE.html"><tt>FRACTALWAVE</tt></a>,        Called: <a href="FRACTALMORPH_BASE.html"><tt>FRACTALMORPH_BASE</tt></a>,</p>      <h2>Function implementation<a name="4"></a></h2>      <pre class="codeinput"><span class="keyword">function</span> [S, varargout] = fractalmorph(I, varargin)</pre>      <pre class="codeinput"><span class="keyword">if</span> isempty(ver(<span class="string">'images'</span>))    error(<span class="string">'fractalmorph:errortoolbox'</span>, <span class="string">'Image Processing toolbox required'</span>);<span class="keyword">end</span></pre>      <p>parsing parameters</p>      <pre class="codeinput">error(nargchk(1, 35, nargin, <span class="string">'struct'</span>));error(nargoutchk(0, 10, nargout, <span class="string">'struct'</span>));<span class="comment">% mandatory parameter</span><span class="keyword">if</span> ~isnumeric(I)    error(<span class="string">'fractalmorph:inputerror'</span>,<span class="string">'a matrix is required in input'</span>);<span class="keyword">end</span><span class="comment">% optional parameters</span>p = createParser(<span class="string">'FRACTALMORPH'</span>);<span class="comment">% additional parameters regarding numerical estimation</span>p.addOptional(<span class="string">'measure'</span>, <span class="string">'oc'</span>, @(x)ischar(x) &amp;&amp; <spanclass="keyword">...</span>    any(strcmpi(x,{<span class="string">'o'</span>,<span class="string">'c'</span>,<spanclass="string">'oco'</span>,<spanclass="string">'coc'</span>,<spanclass="string">'co'</span>,<spanclass="string">'co'</span><spanclass="keyword">...</span>    <span class="comment">% 'rco','roc','ro','rc','roco','rcoc'</span>    })));<span class="comment">% principal scale parameters</span>p.addOptional(<span class="string">'rho'</span>, [], @(x)isfloat(x) &amp;&amp; length(x)&gt;=1 &amp;&amp; any(x)&gt;=0);<span class="comment">% options for multiscale analysis</span>p.addParamValue(<span class="string">'sc0'</span>, 1, @(x)isscalar(x) &amp;&amp; x&gt;0);  <spanclass="comment">% output.sc0</span>p.addParamValue(<span class="string">'scr'</span>, 10, @(x)isscalar(x) &amp;&amp; x&gt;0); <spanclass="comment">% WAV_RANGE</span>p.addParamValue(<span class="string">'scn'</span>, 7, @(x)isscalar(x) &amp;&amp; x&gt;1);  <spanclass="comment">% WPOINTS</span><span class="comment">% minimum and maximum singularity values considered in the histogram</span>p.addParamValue(<span class="string">'hmin'</span>, -1, @(x)isscalar(x) &amp;&amp; isfloat(x) &amp;&amp; x&lt;=0);p.addParamValue(<span class="string">'hmax'</span>, 2, @(x)isscalar(x) &amp;&amp; isfloat(x) &amp;&amp; x&gt;=0 );p.addParamValue(<span class="string">'hstep'</span>, 100, @(x)isscalar(x) &amp;&amp; <spanclass="keyword">...</span>    (isfloat(x) &amp;&amp; x&gt;0 &amp;&amp; x&lt;=1) || (x&gt;1 &amp;&amp; round(x)==x));<span class="comment">% goodness for singularity analysis regression</span>p.addParamValue(<span class="string">'hcorr'</span>, 0.999, @(x)isscalar(x) &amp;&amp; isfloat(x) &amp;&amp; x&gt;=0 &amp;&amp; x&lt;=1);p.addParamValue(<span class="string">'shape'</span>, <span class="string">'disk'</span>, @(x) ischar(x) &amp;&amp; <spanclass="keyword">...</span>    any(strcmpi(x,{<span class="string">'disk'</span>,<span class="string">'rectangle'</span>,<spanclass="string">'square'</span>,<spanclass="string">'diamond'</span>, <spanclass="keyword">...</span>    <span class="string">'line'</span>,<span class="string">'periodicline'</span>,<spanclass="string">'arbitrary'</span>,<spanclass="string">'octagon'</span>,<spanclass="string">'pair'</span>})));<span class="comment">% windex = 0</span><span class="comment">% ord_der = 0</span><span class="comment">% sc0 [0][0] = 1</span><span class="comment">% wavrange = 10</span><span class="comment">% wavpoints = 7</span><span class="comment">% scale_wavelet = sw / max(x,y)</span><span class="comment">% qs = wavrange^(1/(wavpoints-1))</span><span class="comment">% (sc=1, ip=0; ip&lt;=wavpoints; ip++, sc=sc*qs)</span><span class="comment">% xx = 1 / log(sc * sc0)</span><span class="comment">% generate_wavelet_normalize at scale sc</span><span class="comment">% convolve(T)</span><span class="comment">% yy = log(abs(T))</span><span class="comment">% yy *= xx</span><span class="comment">% log(T) = log(alpha) + h*log(r)</span><span class="comment">% parse and validate all input arguments</span>p.parse(varargin{:});p = getvarParser(p);</pre>      <p>checking/setting parameters</p>      <pre class="codeinput">C = size(I,3);<span class="comment">%n_x = X*Y;</span><span class="comment">% if ...</span><span class="comment">%         (strcmp(p.method,'grain') &amp;&amp; ...</span><span class="comment">%         any(strcmp(p.measure,{'rocmax','ocmax','e','d','edmax'}))) || ...</span><span class="comment">%         (strcmp(p.method,'prof') &amp;&amp; ...</span><span class="comment">%         any(strcmp(p.measure,{'oco','coc','co','rco','roco','rcoc'})))</span><span class="comment">%     error('fractalmorph:errorinput',...</span><span class="comment">%         ['incompatible method ' p.method ' and measure ' p.measure]);</span><span class="comment">% end</span></pre>      <p>compute the multifractal decomposition</p>      <pre class="codeinput">[S, Histoh, H, H_r, DH, ErrDh, scales, edges, Tpsi, R] = <spanclass="keyword">...</span>    fractalmorph_base(I, p.measure, p.rho, p.sc0, p.scr, p.scn, <span class="keyword">...</span>    p.hmin, p.hmax, p.hstep, p.shape);<span class="comment">% note: the last element of scales is sc0</span><span class="keyword">if</span> nargout&gt;=2, varargout{1} = Histoh;    <span class="keyword">if</span> nargout&gt;=3, varargout{2} = H;        <span class="keyword">if</span> nargout&gt;=4, varargout{3} = H_r;            <span class="keyword">if</span> nargout&gt;=5, varargout{4} = DH;                <span class="keyword">if</span> nargout&gt;=6,  varargout{5} = ErrDh;                    <span class="keyword">if</span> nargout&gt;=7, varargout{6} = scales;                        <span class="keyword">if</span> nargout&gt;=8, varargout{7} = edges;                            <span class="keyword">if</span> nargout&gt;=9,  varargout{8} = Tpsi;                                <span class="keyword">if</span> nargout==10,  varargout{9} = R;  <spanclass="keyword">end</span>                            <span class="keyword">end</span>                        <span class="keyword">end</span>                    <span class="keyword">end</span>                <span class="keyword">end</span>            <span class="keyword">end</span>        <span class="keyword">end</span>    <span class="keyword">end</span><span class="keyword">end</span></pre>      <p>display</p>      <pre class="codeinput"><span class="keyword">if</span> p.disp    ndisp = 3; mdisp = ceil((length(scales)-1)/ndisp);    <span class="comment">% we distinguish the cases 'riemann' and 'scalar'</span>    <span class="keyword">if</span> C&gt;1        n_x = numel(S{1});        <span class="keyword">for</span> c=1:C            <span class="comment">% display the wavelet transform</span>            figure <span class="comment">% open a display window</span>            <span class="keyword">for</span> r=1:length(scales)-1                subplot(mdisp, ndisp, r),  imagesc(rescale(Tpsi{c}(:,:,r))),                colormap <span class="string">gray</span>, title([<span class="string">'WT at \sigma='</span> num2str(scales(r))])            <span class="keyword">end</span>            S{c}(S{c}&gt;p.hmax) = p.hmax;            h0 = min(S{c}(:));     h1 = max(S{c}(:));            <span class="comment">%delta_h = 0.01;      range_h = (h1 - h0) / delta_h;</span>            <span class="comment">% output range of singularities</span>            disp_sing = [<span class="string">'Singularity range for channel '</span> num2str(c)];            disp([disp_sing <span class="string">': [ '</span> num2str(h0) <spanclass="string">' - '</span> num2str(h1) <spanclass="string">' ]'</span>]);            figure, <span class="comment">% open another window</span>            <span class="comment">% display the singularity exponents</span>            title_sing = [<span class="string">'singularity exponents for channel '</span> num2str(c)];            subplot(1,2,1), imagesc(S{c}), axis <span class="string">image</span> <spanclass="string">off</span>, colormap <spanclass="string">gray</span>,            title(title_sing);            <span class="comment">% output regression rate</span>            disp_reg = [<span class="string">'Good regression points for channel '</span> num2str(c)];            disp([disp_reg <span class="string">': '</span> num2str(100*sum(abs(R{c}(:))&gt;=p.hcorr)/n_x) <spanclass="string">' %'</span>]);            subplot(1,2,2),imagesc(abs(R{c})&gt;=p.hcorr), axis <span class="string">image</span> <spanclass="string">off</span>, colormap <spanclass="string">gray</span>,            title(<span class="string">'''good regression'' map'</span>);            <span class="comment">% display its histogram</span>            title_exp = [<span class="string">'exponents distribution for channel '</span> num2str(c)];            figure, bar(edges,Histoh{c},<span class="string">'histc'</span>), <spanclass="comment">% hist(S{c}(:),range_h)</span>            title(title_exp)            title_spec = [<span class="string">'multifractal spectrum for channel '</span> num2str(c)];            figure, errorbar(H_r{c}, DH{c}, ErrDh{c}/2, ErrDh{c}/2), title(title_spec);        <span class="keyword">end</span>    <span class="keyword">else</span>        n_x = numel(S);        figure;        <span class="keyword">for</span> r=1:length(scales)-1            subplot(mdisp, ndisp, r),  imagesc(rescale(Tpsi(:,:,r))),            colormap <span class="string">gray</span>, title([<span class="string">'WT at \sigma='</span> num2str(scales(r))]);        <span class="keyword">end</span>        S(S&gt;p.hmax) = p.hmax;        h0 = min(S(:));    h1 = max(S(:));        disp([<span class="string">'Singularity range: [ '</span> num2str(h0) <spanclass="string">' - '</span> num2str(h1) <spanclass="string">' ]'</span>]);        figure, subplot(1,2,1), imagesc(S), axis <span class="string">image</span> <spanclass="string">off</span>, colormap <spanclass="string">gray</span>,        title(<span class="string">'singularity exponents'</span>);        disp([<span class="string">'Good regression points: '</span> <span class="keyword">...</span>            num2str(100*sum(abs(R(:))&gt;=p.hcorr) / n_x) <span class="string">' %'</span>]);        subplot(1,2,2), imagesc(abs(R)&gt;=p.hcorr), axis <span class="string">image</span> <spanclass="string">off</span>, colormap <spanclass="string">gray</span>,        title(<span class="string">'''good regression'' map'</span>);        figure, bar(edges,Histoh,<span class="string">'histc'</span>), title(<spanclass="string">'exponents distribution'</span>);        figure, errorbar(H_r, DH, ErrDh/2, ErrDh/2), title(<span class="string">'multifractal spectrum'</span>);    <span class="keyword">end</span><span class="keyword">end</span></pre>      <pre class="codeinput"><span class="keyword">end</span> <span class="comment">% end of fractalmorph</span></pre>    </div>    <!--##### SOURCE BEGIN #####%% FRACTALMORPH %%% Syntax%       S = FRACTALMORPH(I);    %%% Credit% <mailto:grazzja@lanl.gov J.Grazzini> (ISR-2/LANL)%%% See also% Related:% <../../fractal/mftensor/html/FRACTALWAVE.html |FRACTALWAVE|>,% Called:% <FRACTALMORPH_BASE.html |FRACTALMORPH_BASE|>,%% Function implementationfunction [S, varargout] = fractalmorph(I, varargin)if isempty(ver('images'))    error('fractalmorph:errortoolbox', 'Image Processing toolbox required');end%%% parsing parameterserror(nargchk(1, 35, nargin, 'struct'));error(nargoutchk(0, 10, nargout, 'struct'));% mandatory parameterif ~isnumeric(I)    error('fractalmorph:inputerror','a matrix is required in input'); end% optional parametersp = createParser('FRACTALMORPH');   % additional parameters regarding numerical estimationp.addOptional('measure', 'oc', @(x)ischar(x) && ...    any(strcmpi(x,{'o','c','oco','coc','co','co'...    % 'rco','roc','ro','rc','roco','rcoc'    })));% principal scale parametersp.addOptional('rho', [], @(x)isfloat(x) && length(x)>=1 && any(x)>=0);% options for multiscale analysisp.addParamValue('sc0', 1, @(x)isscalar(x) && x>0);  % output.sc0p.addParamValue('scr', 10, @(x)isscalar(x) && x>0); % WAV_RANGEp.addParamValue('scn', 7, @(x)isscalar(x) && x>1);  % WPOINTS% minimum and maximum singularity values considered in the histogramp.addParamValue('hmin', -1, @(x)isscalar(x) && isfloat(x) && x<=0);p.addParamValue('hmax', 2, @(x)isscalar(x) && isfloat(x) && x>=0 );p.addParamValue('hstep', 100, @(x)isscalar(x) && ...    (isfloat(x) && x>0 && x<=1) || (x>1 && round(x)==x));% goodness for singularity analysis regressionp.addParamValue('hcorr', 0.999, @(x)isscalar(x) && isfloat(x) && x>=0 && x<=1);p.addParamValue('shape', 'disk', @(x) ischar(x) && ...    any(strcmpi(x,{'disk','rectangle','square','diamond', ...    'line','periodicline','arbitrary','octagon','pair'})));% windex = 0% ord_der = 0% sc0 [0][0] = 1% wavrange = 10% wavpoints = 7% scale_wavelet = sw / max(x,y)% qs = wavrange^(1/(wavpoints-1))% (sc=1, ip=0; ip<=wavpoints; ip++, sc=sc*qs)% xx = 1 / log(sc * sc0)% generate_wavelet_normalize at scale sc% convolve(T)% yy = log(abs(T))% yy *= xx% log(T) = log(alpha) + h*log(r)% parse and validate all input argumentsp.parse(varargin{:}); p = getvarParser(p);                                                            %%% checking/setting parametersC = size(I,3);%n_x = X*Y;% if ...%         (strcmp(p.method,'grain') && ...%         any(strcmp(p.measure,{'rocmax','ocmax','e','d','edmax'}))) || ...%         (strcmp(p.method,'prof') && ...%         any(strcmp(p.measure,{'oco','coc','co','rco','roco','rcoc'})))%     error('fractalmorph:errorinput',...%         ['incompatible method ' p.method ' and measure ' p.measure]);% end%%% compute the multifractal decomposition[S, Histoh, H, H_r, DH, ErrDh, scales, edges, Tpsi, R] = ...    fractalmorph_base(I, p.measure, p.rho, p.sc0, p.scr, p.scn, ...    p.hmin, p.hmax, p.hstep, p.shape);% note: the last element of scales is sc0if nargout>=2, varargout{1} = Histoh;    if nargout>=3, varargout{2} = H;        if nargout>=4, varargout{3} = H_r;            if nargout>=5, varargout{4} = DH;                if nargout>=6,  varargout{5} = ErrDh;                    if nargout>=7, varargout{6} = scales;                        if nargout>=8, varargout{7} = edges;                            if nargout>=9,  varargout{8} = Tpsi;                                if nargout==10,  varargout{9} = R;  end                            end                        end                    end                end            end        end    endend%% % displayif p.disp            ndisp = 3; mdisp = ceil((length(scales)-1)/ndisp);        % we distinguish the cases 'riemann' and 'scalar'    if C>1         n_x = numel(S{1});        for c=1:C            % display the wavelet transform            figure % open a display window            for r=1:length(scales)-1                subplot(mdisp, ndisp, r),  imagesc(rescale(Tpsi{c}(:,:,r))),                colormap gray, title(['WT at \sigma=' num2str(scales(r))])            end            S{c}(S{c}>p.hmax) = p.hmax;            h0 = min(S{c}(:));     h1 = max(S{c}(:));            %delta_h = 0.01;      range_h = (h1 - h0) / delta_h;            % output range of singularities            disp_sing = ['Singularity range for channel ' num2str(c)];            disp([disp_sing ': [ ' num2str(h0) ' - ' num2str(h1) ' ]']);            figure, % open another window            % display the singularity exponents            title_sing = ['singularity exponents for channel ' num2str(c)];            subplot(1,2,1), imagesc(S{c}), axis image off, colormap gray,            title(title_sing);            % output regression rate            disp_reg = ['Good regression points for channel ' num2str(c)];            disp([disp_reg ': ' num2str(100*sum(abs(R{c}(:))>=p.hcorr)/n_x) ' %']);            subplot(1,2,2),imagesc(abs(R{c})>=p.hcorr), axis image off, colormap gray,            title('''good regression'' map');            % display its histogram            title_exp = ['exponents distribution for channel ' num2str(c)];                  figure, bar(edges,Histoh{c},'histc'), % hist(S{c}(:),range_h)            title(title_exp)            title_spec = ['multifractal spectrum for channel ' num2str(c)];            figure, errorbar(H_r{c}, DH{c}, ErrDh{c}/2, ErrDh{c}/2), title(title_spec);        end            else        n_x = numel(S);        figure;        for r=1:length(scales)-1            subplot(mdisp, ndisp, r),  imagesc(rescale(Tpsi(:,:,r))),            colormap gray, title(['WT at \sigma=' num2str(scales(r))]);        end        S(S>p.hmax) = p.hmax;        h0 = min(S(:));    h1 = max(S(:));        disp(['Singularity range: [ ' num2str(h0) ' - ' num2str(h1) ' ]']);        figure, subplot(1,2,1), imagesc(S), axis image off, colormap gray,         title('singularity exponents');        disp(['Good regression points: ' ...            num2str(100*sum(abs(R(:))>=p.hcorr) / n_x) ' %']);        subplot(1,2,2), imagesc(abs(R)>=p.hcorr), axis image off, colormap gray,        title('''good regression'' map');        figure, bar(edges,Histoh,'histc'), title('exponents distribution');        figure, errorbar(H_r, DH, ErrDh/2, ErrDh/2), title('multifractal spectrum');    endendend % end of fractalmorph##### SOURCE END #####--></body></html>