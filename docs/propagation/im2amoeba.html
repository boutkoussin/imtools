<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>  <head>    <meta content="text/html; charset=utf-8" http-equiv="content-type">    <!--This HTML was auto-generated from MATLAB code.To make changes, update the MATLAB code and republish this document.      -->    <title>IM2AMOEBA - Amoeba-like front propagation over an image.</title>    <meta name="generator" content="MATLAB 7.14">    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">    <meta name="DC.date" content="2012-05-31">    <meta name="DC.source" content="im2amoeba.m">    <style type="text/css">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}html { min-height:100%; margin-bottom:1px; }html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }html body td { vertical-align:top; text-align:left; }h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }a { color:#005fce; text-decoration:none; }a:hover { color:#005fce; text-decoration:underline; }a:visited { color:#004aa0; text-decoration:none; }p { padding:0px; margin:0px 0px 20px; }img { padding:0px; margin:0px 0px 20px; border:none; }p img, pre img, tt img, li img { margin-bottom:0px; } ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }ul li { padding:0px; margin:0px 0px 7px 0px; }ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }ul li ol li { list-style:decimal; }ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }ol li ol li { list-style-type:lower-alpha; }ol li ul { padding-top:7px; }ol li ul li { list-style:square; }.content { font-size:1.2em; line-height:140%; padding: 20px; }pre, tt, code { font-size:12px; }pre { margin:0px 0px 20px; }pre.error { color:red; }pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }span.keyword { color:#0000FF }span.comment { color:#228B22 }span.string { color:#A020F0 }span.untermstring { color:#B20000 }span.syscmd { color:#B28C00 }.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }.footer p { margin:0px; }  </style>  </head>  <body>    <div class="content">      <h1>IM2AMOEBA - Amoeba-like front propagation over an image.</h1>      <!--introduction--><!--/introduction-->      <h2>Contents</h2>      <div>        <ul>          <li><a href="#1">Description</a></li>          <li><a href="#2">Algorithm</a></li>          <li><a href="#3">Syntax</a></li>          <li><a href="#4">Inputs</a></li>          <li><a href="#5">Outputs</a></li>          <li><a href="#7">See also</a></li>          <li><a href="#8">Function implementation</a></li>        </ul>      </div>      <h2>Description<a name="1"></a></h2>      <p>Perform a (multiple) front propagation from a set of seed points using        a metric derived from the input image over its domain.</p>      <h2>Algorithm<a name="2"></a></h2>      <p>Let <img src="im2amoeba_eq09848.png" alt="$d_{\mbox{pixel}}$"> be a        distance defined on the values of the image, for example a difference of        gray-value, or a color distance. Let <img src="im2amoeba_eq57640.png" alt="$P=(x=x_0,x_1,\cdots,x_n=y)$">        a path between points <img src="im2amoeba_eq43551.png" alt="$x$"> and <img          src="im2amoeba_eq44020.png"          alt="$y$">.        Let <img src="im2amoeba_eq23351.png" alt="$\lambda$"> be a real        positive number. The length of the path <img src="im2amoeba_eq86892.png"          alt="$P$">        is defined as</p>      <p><img src="im2amoeba_eq42090.png" alt="$$   L(P) = n + \lambda \cdot d_{\mbox{pixel}}(x_i,x_{i+1})$$"></p>      <p>The "amoeba distance" with parameter <img src="im2amoeba_eq23351.png"          alt="$\lambda$">        is thus defined as:</p>      <p><img src="im2amoeba_eq24213.png" alt="$$   \left\{   \begin{array}{l}   d_\lambda (x,x) = 0 \\   d_\lambda (x,y) = \min_P \{ L(P) \}   \end{array}   \right.$$"></p>      <h2>Syntax<a name="3"></a></h2>      <pre class="language-matlab">D = IM2AMOEBA(I, start_pts);[D, Q] = IM2AMOEBA(I, start_pts, dfeat, dspace, lambda);</pre>      <h2>Inputs<a name="4"></a></h2>      <p><b><tt>I</tt></b> : input image of size <tt>(X,Y,C)</tt>, possibly        multichannel with <tt>C&gt;1</tt>.</p>      <p><b><tt>start_pts</tt></b> : array of size <tt>(2,k)</tt>, where <tt>k</tt>        is the number of starting points, ie. <tt>start_pts(:,i)</tt> are the        coordinates of the <tt>i</tt>-th starting point.</p>      <p><b><tt>dspace</tt></b> : (optional) string defining the distance over        the spatial domain; it is either: <tt>'l1'</tt>, <tt>'l2'</tt> or <tt>'linf'</tt>;        dspace: <tt>dspace='l2'</tt>.</p>      <p><b><tt>dfeat</tt></b> : (optional) string defining the distance over        the feature space (eg. a color distance); it is either: <tt>'l1'</tt>,        <tt>'l2'</tt> or <tt>'linf'</tt>; default: <tt>dfeat='l2'</tt>.</p>      <p><b><tt>lambda</tt></b> : (optional) real parameter used for weighting        the relative influences of spatial domain and spectral range; default: <tt>lambda=1</tt>.</p>      <h2>Outputs<a name="5"></a></h2>      <p><b><tt>D</tt></b> : distance map representing the propagated front from        <tt>start_pts</tt> using the amoeba metric derived from the image.</p>      <p><b><tt>Q</tt></b> : Voronoi-like (labelled) index map.</p>      <h2>See also<a name="7"></a></h2>      <p>Related: <a href="im2front.html"><tt>IM2FRONT</tt></a>, <a href="fmm.html"><tt>FMM</tt></a>,        <a href="../graph/DIJSKTRA.html"><tt>DIJSKTRA</tt></a>, <a href="potential2front.html"><tt>POTENTIAL2FRONT</tt></a>.        Called: <a href="im2amoeba_base.html"><tt>IM2AMOEBA_BASE</tt></a>.</p>      <h2>Function implementation<a name="8"></a></h2>      <pre class="codeinput"><span class="keyword">function</span> [D, Q] = im2amoeba(I, start_pts, varargin)</pre>      <p>parsing and checking parameters</p>      <pre class="codeinput">error(nargchk(1, 16, nargin, <span class="string">'struct'</span>));error(nargoutchk(1, 4, nargout, <span class="string">'struct'</span>));<span class="comment">% mandatory parameter</span><span class="keyword">if</span> ~isnumeric(I)    error(<span class="string">'im2amoeba:inputerror'</span>,<span class="string">'a matrix is required in input'</span>);<span class="keyword">end</span>p = createParser(<span class="string">'IM2AMOEBA'</span>);   <span class="comment">% create an instance of the inputParser class.</span><span class="comment">% additional optional parameters</span>p.addOptional(<span class="string">'dfeat'</span>, <span class="string">'l2'</span>, @(x) isa(x, <spanclass="string">'function_handle'</span>) || <spanclass="keyword">...</span>    (ischar(x) &amp;&amp; any(strcmpi(x,{<span class="string">'l1'</span>,<spanclass="string">'l2'</span>,<spanclass="string">'linf'</span>}))));p.addOptional(<span class="string">'lambda'</span>, 1, @(x)isscalar(x) &amp;&amp; x&gt;=0);p.addOptional(<span class="string">'dspace'</span>, <span class="string">'l2'</span>, @(x) isa(x, <spanclass="string">'function_handle'</span>) || <spanclass="keyword">...</span>    (ischar(x) &amp;&amp; any(strcmpi(x,{<span class="string">'l1'</span>,<spanclass="string">'l2'</span>}))));<span class="comment">% parse and validate all input arguments</span>p.parse(varargin{:});p = getvarParser(p);</pre>      <p>checking/setting variables</p>      <pre class="codeinput"><span class="keyword">if</span> ischar(p.dfeat)   <span class="keyword">switch</span> p.dfeat       <span class="keyword">case</span> <span class="string">'l1'</span>           p.dfeat = @(c0, c1) sum(abs(c1-c0), 2);       <span class="keyword">case</span> <span class="string">'l2'</span>           p.dfeat = @(c0, c1) sqrt(sum((c1-c0).^2, 2));       <span class="keyword">case</span> <span class="string">'linf'</span>           p.dfeat = @(c0, c1) max(c1-c0, [], 2);   <span class="keyword">end</span><span class="keyword">end</span><span class="keyword">if</span> ischar(p.dspace)   <span class="keyword">switch</span> p.dspace       <span class="keyword">case</span> <span class="string">'l1'</span> <spanclass="comment">% Mahnattan (city-block) distance</span>           p.dspace = @(c0, c1) sum(abs(c1-c0), 2);       <span class="keyword">case</span> <span class="string">'l2'</span>           p.dspace = @(c0, c1) sqrt(sum((c1-c0).^2, 2));   <span class="keyword">end</span><span class="keyword">end</span></pre>      <p>main computation</p>      <pre class="codeinput">[D, Q] = im2amoeba_base(I, start_pts, p.dfeat, p.lambda, p.dspace);</pre>      <p>display</p>      <pre class="codeinput"><span class="keyword">if</span> p.disp    figure;    <span class="keyword">if</span> isempty(ver(<span class="string">'images'</span>))        subplot(1,3,1), imagesc(rescale(I));        subplot(1,3,2), imagesc(Q), colormap <span class="string">jet</span>;    <span class="keyword">else</span>        M = (imdilate(Q,ones(3,3))-Q==0);        subplot(1,3,2), imagesc(label2rgb(Q.*M)), axis <span class="string">image</span> <spanclass="string">off</span>;        M = cat(3,M,M,M);        subplot(1,3,1), imagesc(rescale(I.*M)+(1-M)), axis <span class="string">image</span> <spanclass="string">off</span>;    <span class="keyword">end</span>    subplot(1,3,2), hold <span class="string">on</span>, plot(start_pts(1,:),start_pts(2,:),<spanclass="string">'*r'</span>),    hold <span class="string">off</span>;    subplot(1,3,3), imagesc(rescale(D)), colormap <span class="string">gray</span>, axis <spanclass="string">image</span> <spanclass="string">off</span>;    hold <span class="string">on</span>, plot(start_pts(1,:),start_pts(2,:),<spanclass="string">'*r'</span>), hold <spanclass="string">off</span>    suptitle(<span class="string">'amoeba neighbourhoods'</span>)<span class="keyword">end</span></pre>      <pre class="codeinput"><span class="keyword">end</span> <span class="comment">% end of im2amoeba</span></pre></div>    <!--##### SOURCE BEGIN #####%% IM2AMOEBA - Amoeba-like front propagation over an image.%%% Description% Perform a (multiple) front propagation from a set of seed points using a% metric derived from the input image over its domain.% %% Algorithm% Let $d_{\mbox{pixel}}$ be a distance defined on the values of the image,% for example a difference of gray-value, or a color distance. % Let $P=(x=x_0,x_1,\cdots,x_n=y)$ a path between points $x$ and $y$. Let % $\lambda$ be a real positive number. The length of the path $P$ is defined% as %% $$%    L(P) = n + \lambda \cdot d_{\mbox{pixel}}(x_i,x_{i+1}) % $$%% The "amoeba distance" with parameter $\lambda$ is thus defined as:  %% $$%    \left\{%    \begin{array}{l}%    d_\lambda (x,x) = 0 \\%    d_\lambda (x,y) = \min_P \{ L(P) \} %    \end{array}%    \right.% $$%%% Syntax%   D = IM2AMOEBA(I, start_pts);%   [D, Q] = IM2AMOEBA(I, start_pts, dfeat, dspace, lambda);%%% Inputs% *|I|* : input image of size |(X,Y,C)|, possibly multichannel with |C>1|.%% *|start_pts|* : array of size |(2,k)|, where |k| is the number of starting%     points, ie. |start_pts(:,i)| are the coordinates of the |i|-th starting %     point.%% *|dspace|* : (optional) string defining the distance over the spatial%     domain; it is either: |'l1'|, |'l2'| or |'linf'|; dspace: |dspace='l2'|.%% *|dfeat|* : (optional) string defining the distance over the feature space%     (eg. a color distance); it is either: |'l1'|, |'l2'| or |'linf'|;%     default: |dfeat='l2'|.%% *|lambda|* : (optional) real parameter used for weighting the relative%     influences of spatial domain and spectral range; default: |lambda=1|.%%%% Outputs% *|D|* : distance map representing the propagated front from |start_pts| %     using the amoeba metric derived from the image.%% *|Q|* : Voronoi-like (labelled) index map.%  %% Credit% <mailto:grazzja@lanl.gov J.Grazzini> (ISR-2/LANL)%%% See also% Related:% <im2front.html |IM2FRONT|>, % <fmm.html |FMM|>, % <../graph/DIJSKTRA.html |DIJSKTRA|>, % <potential2front.html |POTENTIAL2FRONT|>.% Called: % <im2amoeba_base.html |IM2AMOEBA_BASE|>.%% Function implementationfunction [D, Q] = im2amoeba(I, start_pts, varargin)%%% parsing and checking parameterserror(nargchk(1, 16, nargin, 'struct'));error(nargoutchk(1, 4, nargout, 'struct'));% mandatory parameterif ~isnumeric(I)    error('im2amoeba:inputerror','a matrix is required in input'); endp = createParser('IM2AMOEBA');   % create an instance of the inputParser class.% additional optional parametersp.addOptional('dfeat', 'l2', @(x) isa(x, 'function_handle') || ...    (ischar(x) && any(strcmpi(x,{'l1','l2','linf'}))));p.addOptional('lambda', 1, @(x)isscalar(x) && x>=0);p.addOptional('dspace', 'l2', @(x) isa(x, 'function_handle') || ...    (ischar(x) && any(strcmpi(x,{'l1','l2'}))));% parse and validate all input argumentsp.parse(varargin{:}); p = getvarParser(p);                                                            %% % checking/setting variablesif ischar(p.dfeat)    switch p.dfeat       case 'l1'           p.dfeat = @(c0, c1) sum(abs(c1-c0), 2);       case 'l2'           p.dfeat = @(c0, c1) sqrt(sum((c1-c0).^2, 2));       case 'linf'           p.dfeat = @(c0, c1) max(c1-c0, [], 2);   endendif ischar(p.dspace)    switch p.dspace       case 'l1' % Mahnattan (city-block) distance           p.dspace = @(c0, c1) sum(abs(c1-c0), 2);       case 'l2'           p.dspace = @(c0, c1) sqrt(sum((c1-c0).^2, 2));   endend%% % main computation[D, Q] = im2amoeba_base(I, start_pts, p.dfeat, p.lambda, p.dspace);%%% displayif p.disp    figure;    if isempty(ver('images'))        subplot(1,3,1), imagesc(rescale(I));        subplot(1,3,2), imagesc(Q), colormap jet;    else        M = (imdilate(Q,ones(3,3))-Q==0);        subplot(1,3,2), imagesc(label2rgb(Q.*M)), axis image off;        M = cat(3,M,M,M);        subplot(1,3,1), imagesc(rescale(I.*M)+(1-M)), axis image off;    end    subplot(1,3,2), hold on, plot(start_pts(1,:),start_pts(2,:),'*r'),    hold off;    subplot(1,3,3), imagesc(rescale(D)), colormap gray, axis image off;    hold on, plot(start_pts(1,:),start_pts(2,:),'*r'), hold off    suptitle('amoeba neighbourhoods')endend % end of im2amoeba##### SOURCE END #####-->  </body></html>