<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>STRUCTA2ASTRUCT
      - Convert a structure of arrays to an array of structures.</title>
    <meta name="generator" content="MATLAB 7.11">
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
    <meta name="DC.date" content="2011-05-10">
    <meta name="DC.source" content="structa2astruct.m">
    <style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style>
  </head>
  <body>
    <div class="content">
      <h1>STRUCTA2ASTRUCT - Convert a structure of arrays to
        an array of structures.</h1>
      <!--introduction--><!--/introduction-->
      <h2>Contents</h2>
      <div>
        <ul>
          <li><a href="#1">Syntax</a></li>
          <li><a href="#2">Remark</a></li>
          <li><a href="#3">Credit</a></li>
          <li><a href="#4">See also</a></li>
          <li><a href="#5">Function implementation</a></li>
        </ul>
      </div>
      <h2>Syntax<a name="1"></a></h2>
      <pre>        A = STRUCTA2ASTRUCT(S);
        [A, fields] = STRUCTA2ASTRUCT(S, destroy, fields, ...);</pre>
      <h2>Remark<a name="2"></a></h2>
      <p>See discussion at <a href="http://blogs.mathworks.com/pick/2008/04/22/matlab-basics-array-of-structures-vs-structures-of-arrays/">http://blogs.mathworks.com/pick/2008/04/22/matlab-basics-array-of-structures-vs-structures-of-arrays/</a></p>
      <h2>See also<a name="4"></a></h2>
      <p>Related: <a href="matlab:webpub%28whichpath%28%27STRUCT%27%29%29"><tt>STRUCT</tt></a>,
        <a href="matlab:webpub%28whichpath%28%27STRUCT2CELL%27%29%29"><tt>STRUCT2CELL</tt></a>.</p>
      <h2>Function implementation<a name="5"></a></h2>
      <pre class="codeinput"><span class="keyword">function</span> [A,fields] = structa2astruct(S,destroy,varargin)

error(nargoutchk(1, 2, nargout, <span class="string">'struct'</span>));
<span class="keyword">if</span> ~isstruct(S)
    error(<span class="string">'structa2astruct:inputerror'</span>,<span
class="string">'structure required in input'</span>)
<span class="keyword">end</span>

<span class="keyword">if</span> isempty(destroy), destroy=false; <span class="keyword">end</span>

fields = fieldnames(S);

<span class="keyword">for</span> ip=1:numel(fields)

    <span class="keyword">if</span> nargin&gt;1 &amp;&amp; ~any(strcmpi(fields{ip},varargin))
        <span class="keyword">continue</span>;
        <span class="comment">% else: we agree to fill A with all fields found in S</span>
    <span class="keyword">end</span>

    <span class="keyword">if</span> iscell(S.(fields{ip})) <span class="comment">% already a cell array</span>
        cell_field = S.(fields{ip});
        <span class="keyword">if</span> ~isempty(cell_field)
            <span class="comment">% assign the field across the structure array,</span>
            [A(1:length(cell_field)).(fields{ip})] = cell_field{:};
        <span class="keyword">end</span>

    <span class="keyword">elseif</span> isstruct(S.(fields{ip})) <span class="comment">% a structure: recursive call</span>
        warning(<span class="string">'structa2astruct:method'</span>,<span
class="string">'unsolved conversion of struct'</span>)
        struct_field = stra2astr(S.(fields{ip}));                      <span
class="comment">%#ok</span>

    <span class="keyword">else</span>  <span class="comment">% create cells (concatenating the columns)</span>
        cell_field = num2cell(S.(fields{ip}),2);
        <span class="keyword">if</span> ~isempty(cell_field)
            <span class="comment">% assign the field across the structure array,</span>
            [A(1:length(cell_field)).(fields{ip})] = cell_field{:};
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% possibly clean up</span>
    <span class="keyword">if</span> destroy,  S.(fields{ip}) = [];  <span
class="keyword">end</span>

<span class="keyword">end</span>

<span class="keyword">end</span> <span class="comment">% end of structa2astruct</span>
</pre>
    </div>
    <!--##### SOURCE BEGIN #####
%% STRUCTA2ASTRUCT - Convert a structure of arrays to an array of structures.%
%% Syntax%          A = STRUCTA2ASTRUCT(S);
%          [A, fields] = STRUCTA2ASTRUCT(S, destroy, fields, ...);% 
%% Remark% See discussion at
% http://blogs.mathworks.com/pick/2008/04/22/matlab-basics-array-of-structures-vs-structures-of-arrays/%
%% Credit% <mailto:grazzja@lanl.gov J.Grazzini> (ISR-2/LANL)
%%% See also  
% Related: % <matlab:webpub(whichpath('STRUCT')) |STRUCT|>,
% <matlab:webpub(whichpath('STRUCT2CELL')) |STRUCT2CELL|>.%% Function implementation
function [A,fields] = structa2astruct(S,destroy,varargin)error(nargoutchk(1, 2, nargout, 'struct'));
if ~isstruct(S)    error('structa2astruct:inputerror','structure required in input') 
endif isempty(destroy), destroy=false; end
fields = fieldnames(S);
for ip=1:numel(fields)
        if nargin>1 && ~any(strcmpi(fields{ip},varargin))
        continue;        % else: we agree to fill A with all fields found in S
    end    
    if iscell(S.(fields{ip})) % already a cell array        cell_field = S.(fields{ip});
        if ~isempty(cell_field)            % assign the field across the structure array,
            [A(1:length(cell_field)).(fields{ip})] = cell_field{:};        end
        elseif isstruct(S.(fields{ip})) % a structure: recursive call
        warning('structa2astruct:method','unsolved conversion of struct')        struct_field = stra2astr(S.(fields{ip}));                      %#ok        
            else  % create cells (concatenating the columns)
        cell_field = num2cell(S.(fields{ip}),2);        if ~isempty(cell_field)
            % assign the field across the structure array,            [A(1:length(cell_field)).(fields{ip})] = cell_field{:};
        end    end
            % possibly clean up
    if destroy,  S.(fields{ip}) = [];  end    
end        end % end of structa2astruct
##### SOURCE END #####-->
  </body>
</html>
