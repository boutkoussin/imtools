<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>  <head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">    <!--This HTML was auto-generated from MATLAB code.To make changes, update the MATLAB code and republish this document.      -->    <title>READENVIRASTER - Read an image of ENVI standard type to a MATLAB      array.</title>    <meta name="generator" content="MATLAB 7.14">    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">    <meta name="DC.date" content="2012-11-14">    <meta name="DC.source" content="readenviraster.m">    <style type="text/css">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}html { min-height:100%; margin-bottom:1px; }html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }html body td { vertical-align:top; text-align:left; }h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }a { color:#005fce; text-decoration:none; }a:hover { color:#005fce; text-decoration:underline; }a:visited { color:#004aa0; text-decoration:none; }p { padding:0px; margin:0px 0px 20px; }img { padding:0px; margin:0px 0px 20px; border:none; }p img, pre img, tt img, li img { margin-bottom:0px; } ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }ul li { padding:0px; margin:0px 0px 7px 0px; }ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }ul li ol li { list-style:decimal; }ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }ol li ol li { list-style-type:lower-alpha; }ol li ul { padding-top:7px; }ol li ul li { list-style:square; }.content { font-size:1.2em; line-height:140%; padding: 20px; }pre, tt, code { font-size:12px; }pre { margin:0px 0px 20px; }pre.error { color:red; }pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }span.keyword { color:#0000FF }span.comment { color:#228B22 }span.string { color:#A020F0 }span.untermstring { color:#B20000 }span.syscmd { color:#B28C00 }.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }.footer p { margin:0px; }  </style>  </head>  <body>    <div class="content">      <h1>READENVIRASTER - Read an image of ENVI standard type to a MATLAB        array.</h1>      <!--introduction--><!--/introduction-->      <h2>Contents</h2>      <div>        <ul>          <li><a href="#1">Syntax</a></li>          <li><a href="#2">Input</a></li>          <li><a href="#3">Outputs</a></li>          <li><a href="#4">Remark</a></li>          <li><a href="#6">See also</a></li>          <li><a href="#7">Function implementation</a></li>        </ul>      </div>      <h2>Syntax<a name="1"></a></h2>      <pre>     image = READENVIRASTER(fname);     [image,p,t] = READENVIRASTER(fname, ext);</pre>      <h2>Input<a name="2"></a></h2>      <p><b><tt>fname</tt></b> : string giving the full pathname of the ENVI        image to read.</p>      <h2>Outputs<a name="3"></a></h2>      <p><b><tt>image</tt></b> : array of size <tt>(c,l,b)</tt> containing the        ENVI image values organised</p>      <pre class="codeinput"><span class="comment">%	  in |c| cols, |l| lines and |b| bands.</span><span class="comment">%</span><span class="comment">% *|p|* : vector of size |(1,3)| that contains (1) the nb of cols, (2) the</span><span class="comment">%     number of lines and (3) the number of bands of the opened image.</span><span class="comment">%</span><span class="comment">% *|t|* : string describing the image data type string in MATLAB conventions.</span><span class="comment">%</span></pre>      <h2>Remark<a name="4"></a></h2>      <p><tt>READENVIRASTER</tt> needs the corresponding image header file        generated automatically by ENVI. The ENVI header file must have the same        name as the ENVI image file + the '.hdf' exention.</p>      <h2>See also<a name="6"></a></h2>      <p>Related: <a href="READENVIROI.html"><tt>READENVIROI</tt></a>.</p>      <h2>Function implementation<a name="7"></a></h2>      <pre class="codeinput"><span class="keyword">function</span> [image,p,t] = readenviraster(fname,varargin)</pre>      <p>parameters initialization</p>      <pre class="codeinput">elements={<span class="string">'samples '</span> <spanclass="string">'lines   '</span> <spanclass="string">'bands   '</span> <spanclass="string">'bands '</span> <spanclass="string">'data type '</span>};d={<span class="string">'bit8'</span> <span class="string">'int16'</span> <spanclass="string">'int32'</span> <spanclass="string">'float32'</span> <spanclass="string">'float64'</span> <spanclass="string">'uint16'</span> <spanclass="string">'uint32'</span> <spanclass="string">'int64'</span> <spanclass="string">'uint64'</span>};</pre>      <p>check user input</p>      <pre class="codeinput"><span class="keyword">if</span> ~ischar(fname)    error(<span class="string">'readenviraster:errorinput'</span>, <span class="string">'fname should be a char string'</span>);<span class="keyword">end</span><span class="keyword">if</span> nargin&gt;=2    ext=varargin{1};    <span class="keyword">if</span> ~isempty(ext) &amp;&amp; ~strcmp(ext(1),<spanclass="string">'.'</span>)        ext=strcat(<span class="string">'.'</span>,ext);    <span class="keyword">end</span>    <span class="keyword">if</span> nargin==3,  disp = varargin{2};    <span class="keyword">else</span>           disp = false;        <span class="keyword">end</span><span class="keyword">else</span> <span class="comment">% default: empty string</span>    ext = <span class="string">''</span>;    disp = false;<span class="keyword">end</span></pre>      <p>open ENVI header file to retreive s, l, b &amp; d variables</p>      <pre class="codeinput">rfid = fopen(strcat(fname,<span class="string">'.hdr'</span>),<spanclass="string">'r'</span>);</pre>      <p>check if the header file is correctely open</p>      <pre class="codeinput"><span class="keyword">if</span> rfid == -1    error(<span class="string">'readenviraster:readerror'</span>,<span class="string">'input header file does not exist'</span>);<span class="keyword">end</span>;</pre>      <p>read ENVI image header file and get p(1) : nb samples, p(2) : nb lines,        p(3) : nb bands and t : data type</p>      <pre class="codeinput"><span class="keyword">while</span> 1    tline = fgetl(rfid);    <span class="keyword">if</span> ~ischar(tline), <span class="keyword">break</span>, <spanclass="keyword">end</span>    [first,second]=strtok(tline,<span class="string">'='</span>);    <span class="keyword">switch</span> first        <span class="keyword">case</span> elements(1)            [~,s] = strtok(second);            p(1) = str2double(s);        <span class="keyword">case</span> elements(2)            [~,s] = strtok(second);            p(2) = str2double(s);        <span class="keyword">case</span> elements(3)            [~,s] = strtok(second);            p(3) = str2double(s);        <span class="keyword">case</span> elements(4)            [~,s] = strtok(second);            p(3) = str2double(s);        <span class="keyword">case</span> elements(5)            [~,s] = strtok(second);            t = str2double(s);            <span class="keyword">switch</span> t                <span class="keyword">case</span> 1                    t = d(1);                <span class="keyword">case</span> 2                    t = d(2);                <span class="keyword">case</span> 3                    t = d(3);                <span class="keyword">case</span> 4                    t = d(4);                <span class="keyword">case</span> 5                    t = d(5);                <span class="keyword">case</span> 12                    t = d(6);                <span class="keyword">case</span> 13                    t = d(7);                <span class="keyword">case</span> 14                    t = d(8);                <span class="keyword">case</span> 15                    t = d(9);                <span class="keyword">otherwise</span>                    error(<span class="string">'readenviraster:errorinput'</span>, <spanclass="string">'unknown image data type'</span>);            <span class="keyword">end</span>    <span class="keyword">end</span><span class="keyword">end</span>fclose(rfid);t = t{1,1};</pre>      <p>open the ENVI image and store it in the 'image' MATLAB array</p>      <pre class="codeinput"><span class="keyword">if</span> disp    disp([(<span class="string">'Opening '</span>), <span class="keyword">...</span>        (num2str(p(1))),(<span class="string">'cols x '</span>),<span class="keyword">...</span>        (num2str(p(2))),(<span class="string">'lines x '</span>),<span class="keyword">...</span>        (num2str(p(3))),(<span class="string">'bands'</span>),<span class="keyword">...</span>        (<span class="string">'of type '</span>), (t), (<span class="string">' image...'</span>)]);<span class="keyword">end</span></pre>      <p>read and store into an image</p>      <pre class="codeinput">fid = fopen(strcat(fname,ext));image = fread(fid,t);image = reshape(image,[p(1),p(2),p(3)]);</pre>      <p>close the file</p>      <pre class="codeinput">fclose(fid);<span class="comment">% disp([('Image data type : '),(t)])</span></pre>      <pre class="codeinput"><span class="keyword">end</span> <span class="comment">% end of readenviraster</span></pre>    </div>    <!--##### SOURCE BEGIN #####%% READENVIRASTER - Read an image of ENVI standard type to a MATLAB array.%%% Syntax%       image = READENVIRASTER(fname);%       [image,p,t] = READENVIRASTER(fname, ext);%%% Input% *|fname|* : string giving the full pathname of the ENVI image to read.%%% Outputs% *|image|* : array of size |(c,l,b)| containing the ENVI image values organised %	  in |c| cols, |l| lines and |b| bands.%% *|p|* : vector of size |(1,3)| that contains (1) the nb of cols, (2) the %     number of lines and (3) the number of bands of the opened image.%% *|t|* : string describing the image data type string in MATLAB conventions.%%% Remark% |READENVIRASTER| needs the corresponding image header file generated % automatically by ENVI. The ENVI header file must have the same name as the % ENVI image file + the '.hdf' exention.%%% Credit% <mailto:grazzja@lanl.gov J.Grazzini> (ISR-2/LANL)%%% See also % Related:% <READENVIROI.html |READENVIROI|>.%% Function implementationfunction [image,p,t] = readenviraster(fname,varargin)%%% parameters initializationelements={'samples ' 'lines   ' 'bands   ' 'bands ' 'data type '};d={'bit8' 'int16' 'int32' 'float32' 'float64' 'uint16' 'uint32' 'int64' 'uint64'};%%% check user inputif ~ischar(fname)    error('readenviraster:errorinput', 'fname should be a char string');endif nargin>=2    ext=varargin{1};    if ~isempty(ext) && ~strcmp(ext(1),'.')        ext=strcat('.',ext);    end    if nargin==3,  disp = varargin{2};      else           disp = false;        endelse % default: empty string    ext = '';    disp = false;end%%% open ENVI header file to retreive s, l, b & d variablesrfid = fopen(strcat(fname,'.hdr'),'r');%%% check if the header file is correctely openif rfid == -1    error('readenviraster:readerror','input header file does not exist');end;%%% read ENVI image header file and get p(1) : nb samples,% p(2) : nb lines, p(3) : nb bands and t : data typewhile 1    tline = fgetl(rfid);    if ~ischar(tline), break, end    [first,second]=strtok(tline,'=');        switch first        case elements(1)            [~,s] = strtok(second);            p(1) = str2double(s);        case elements(2)            [~,s] = strtok(second);            p(2) = str2double(s);        case elements(3)            [~,s] = strtok(second);            p(3) = str2double(s);        case elements(4)            [~,s] = strtok(second);            p(3) = str2double(s);        case elements(5)            [~,s] = strtok(second);            t = str2double(s);            switch t                case 1                    t = d(1);                case 2                    t = d(2);                case 3                    t = d(3);                case 4                    t = d(4);                case 5                    t = d(5);                case 12                    t = d(6);                case 13                    t = d(7);                case 14                    t = d(8);                case 15                    t = d(9);                otherwise                    error('readenviraster:errorinput', 'unknown image data type');            end                endendfclose(rfid);t = t{1,1};%%% open the ENVI image and store it in the 'image' MATLAB arrayif disp    disp([('Opening '), ...        (num2str(p(1))),('cols x '),...        (num2str(p(2))),('lines x '),...        (num2str(p(3))),('bands'),...        ('of type '), (t), (' image...')]);end%%% read and store into an imagefid = fopen(strcat(fname,ext));image = fread(fid,t);image = reshape(image,[p(1),p(2),p(3)]);%%% close the filefclose(fid);% disp([('Image data type : '),(t)])end % end of readenviraster##### SOURCE END #####-->  </body></html>