<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>  <head>    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <title>ROIREADENVI - Read ENVI files.</title>    <meta name="generator" content="MATLAB 7.11">    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">    <meta name="DC.date" content="2011-05-04">    <meta name="DC.source" content="roireadenvi.m">    <style type="text/css">body {  background-color: white;  margin:10px;}h1 {  color: #990000;   font-size: x-large;}h2 {  color: #990000;  font-size: medium;}/* Make the text shrink to fit narrow windows, but not stretch too far in wide windows. */ p,h1,h2,div.content div {  max-width: 600px;  /* Hack for IE6 */  width: auto !important; width: 600px;}pre.codeinput {  background: #EEEEEE;  padding: 10px;}@media print {  pre.codeinput {word-wrap:break-word; width:100%;}} span.keyword {color: #0000FF}span.comment {color: #228B22}span.string {color: #A020F0}span.untermstring {color: #B20000}span.syscmd {color: #B28C00}pre.codeoutput {  color: #666666;  padding: 10px;}pre.error {  color: red;}p.footer {  text-align: right;  font-size: xx-small;  font-weight: lighter;  font-style: italic;  color: gray;}  </style>  </head>  <body>    <div class="content">      <h1>ROIREADENVI - Read ENVI files.</h1>      <!--introduction--><!--/introduction-->      <h2>Contents</h2>      <div>        <ul>          <li><a href="#1">Description</a></li>          <li><a href="#2">Syntax</a></li>          <li><a href="#3">Output</a></li>          <li><a href="#4">Remark</a></li>          <li><a href="#5">Acknowledgment</a></li>          <li><a href="#6">Function implementation</a></li>        </ul>      </div>      <h2>Description<a name="1"></a></h2>      <p>This function reads in an ENVI ROI file and outputs a Struct        containing</p>      <pre> ROI Name:         ROI.'ROI Number'.'Name'     (Char) ROI Color:        ROI.'ROI Number'.'Color'    (vector) ROI Num Points:   ROI.'ROI Number'.numPoints  (scalar) ROI Data:         ROI.'ROI Number'.Points     (matrix)</pre>      <h2>Syntax<a name="2"></a></h2>      <pre>   ROI = ROIREADENVI(roiFile);</pre>      <h2>Output<a name="3"></a></h2>      <pre>  ROI : the data in each cell of the struct is as outlined above. the matrix    is of size # of bands plus the ID number, and (X,Y) coordinates by the    number of points in the ROI.</pre>      <h2>Remark<a name="4"></a></h2>      <p>Note that this function assumes a strict formatting standard        for the ROI file. IT IS DESIGNED TO ONLY WORK ON THE ENVI ROI        FILES SAVED IN ASCII FORMAT. The ROI points must follow        immediately after the last ROI information line in the file top        matter. There is a commented out while loop that was intended to        test for the start of the ROI points, but was removed for        convience. However, a more robust algorithm will test for the        start of the ROI points so as to avoid strict formatting errors.        Future improvements to this code may incorporate reading        additional ROI file formats and/or the test for teh start of the        roi points.</p>      <h2>Acknowledgment<a name="5"></a></h2>      <p>Written by Jared Herweg, Rochester Institute of Technology, May        2010 <a href="mailto:jxh6389@rit.edu">jxh6389@rit.edu</a></p>      <pre class="codeinput"><span class="comment">% Redistribution and use in source and binary forms, with or without</span><span class="comment">% modification, are permitted provided that the following conditions are</span><span class="comment">% met:</span><span class="comment">%   - Redistributions of source code must retain the above copyright</span><span class="comment">%     notice, this list of conditions and the following disclaimer.</span><span class="comment">%   - Redistributions in binary form must reproduce the above copyright</span><span class="comment">%     notice, this list of conditions and the following disclaimer in the</span><span class="comment">%     documentation and/or other materials provided with the distribution.</span><span class="comment">%   - Neither the name of Rochester Institute of Technology nor the names</span><span class="comment">%     of its contributors may be used to endorse or promote products</span><span class="comment">%     derived from this software without specific prior written permission.</span><span class="comment">%</span><span class="comment">% DISCLAMER:</span><span class="comment">% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS</span><span class="comment">% IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span><span class="comment">% THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span><span class="comment">% PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR</span><span class="comment">% CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span><span class="comment">% EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span><span class="comment">% PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span><span class="comment">% PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span><span class="comment">% LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span><span class="comment">% NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span><span class="comment">% SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></pre>      <h2>Function implementation<a name="6"></a></h2>      <pre class="codeinput"><span class="keyword">function</span> ROI = roireadenvi(roiFile)<span class="comment">% Open File</span>fid = fopen(roiFile);<span class="comment">% Get ROI header information</span>ROI = <span class="string">''</span>; <span class="comment">% Initialize Struct</span>test = [];<span class="keyword">while</span> isempty(test)    fline = fgetl(fid);    <span class="comment">% find number of ROIs</span>     test = find(strncmp(<span class="string">'; Number of'</span>, fline, 11));    <span class="comment">% test = strmatch('; Number of',fline);</span><span class="keyword">end</span>ROI.(<span class="string">'NumROI'</span>) = str2double(strtrim(fline(strfind(fline,<spanclass="string">':'</span>)+1:end)));test = [];<span class="comment">% For each ROI, get associated info</span><span class="keyword">for</span> count = 1:ROI.NumROI    <span class="keyword">while</span> isempty(test)        fline = fgetl(fid);        test = find(strncmp(<span class="string">'; ROI name'</span>, fline, 10));       <span class="comment">% test = strmatch('; ROI name',fline);</span>    <span class="keyword">end</span>    ROIName = strtrim(fline(strfind(fline,<span class="string">':'</span>)+1:end));    fline = fgetl(fid);    ROIcolor = str2double(strtrim(fline(strfind(fline,<span class="string">'{'</span>)+1:end-1)));    fline = fgetl(fid);    ROI_numPts = strtrim(fline(strfind(fline,<span class="string">':'</span>)+1:end));    <span class="comment">% Dynamically expand struct and assign ROI information to cell</span>    <span class="comment">% fields</span>    ROIcnt = [<span class="string">'R'</span> num2str(count)]; <span class="comment">% Each independent ROI name assigned</span>    ROI.(ROIcnt).(<span class="string">'Name'</span>) = ROIName;    ROI.(ROIcnt).(<span class="string">'Color'</span>) = ROIcolor;    ROI.(ROIcnt).(<span class="string">'numPts'</span>) = str2double(ROI_numPts);    test = [];<span class="keyword">end</span><span class="comment">% Get the ROI Points for each ROI</span><span class="comment">% Advance to the start of the ROI points</span><span class="comment">%     while isempty(test)</span>fline = fgetl(fid);<span class="comment">%         test = strmatch(';   ID',fline);</span><span class="comment">%     end</span><span class="comment">% Get number of bands in ROI</span>NumBands = length(find(fline == <span class="string">'B'</span>));<span class="comment">% Add 3 fields to num bands to account for ROI point ID and the</span><span class="comment">% x,y coordinates (see ROI ASCII file).</span>NumBands = NumBands + 3;<span class="comment">% For each ROI, get the associative ROI points</span><span class="keyword">for</span> count = 1:ROI.NumROI    ROIcnt = [<span class="string">'R'</span> num2str(count)];    ROI.(ROIcnt).(<span class="string">'Points'</span>) = zeros(ROI.(ROIcnt).numPts,NumBands);    <span class="keyword">for</span> count2 = 1:ROI.(ROIcnt).numPts        fline = fgetl(fid);        ROI.(ROIcnt).Points(count2,:) = str2double(fline);    <span class="keyword">end</span>    <span class="comment">% fline = fgetl(fid); % skips the blank line</span><span class="keyword">end</span><span class="comment">% Close ROI File</span>fclose(fid);<span class="keyword">end</span></pre> </div>    <!--##### SOURCE BEGIN #####%% ROIREADENVI - Read ENVI files.%%% Description% This function reads in an ENVI ROI file and outputs a Struct containing%%   ROI Name:         ROI.'ROI Number'.'Name'     (Char)%   ROI Color:        ROI.'ROI Number'.'Color'    (vector)%   ROI Num Points:   ROI.'ROI Number'.numPoints  (scalar)%   ROI Data:         ROI.'ROI Number'.Points     (matrix)%%% Syntax %     ROI = ROIREADENVI(roiFile);%%% Output%    ROI : the data in each cell of the struct is as outlined above. the matrix%      is of size # of bands plus the ID number, and (X,Y) coordinates by the%      number of points in the ROI.%%% Remark% Note that this function assumes a strict formatting standard for the ROI% file.  IT IS DESIGNED TO ONLY WORK ON THE ENVI ROI FILES SAVED IN ASCII % FORMAT.  The ROI points must follow immediately after the last ROI% information line in the file top matter.  There is a commented out while% loop that was intended to test for the start of the ROI points, but was% removed for convience.  However, a more robust algorithm will test for% the start of the ROI points so as to avoid strict formatting errors.% Future improvements to this code may incorporate reading additional ROI % file formats and/or the test for teh start of the roi points.%%% Acknowledgment% Written by Jared Herweg, Rochester Institute of Technology, May 2010% jxh6389@rit.edu% Redistribution and use in source and binary forms, with or without % modification, are permitted provided that the following conditions are % met: %   - Redistributions of source code must retain the above copyright %     notice, this list of conditions and the following disclaimer. %   - Redistributions in binary form must reproduce the above copyright %     notice, this list of conditions and the following disclaimer in the %     documentation and/or other materials provided with the distribution.%   - Neither the name of Rochester Institute of Technology nor the names %     of its contributors may be used to endorse or promote products %     derived from this software without specific prior written permission.% % DISCLAMER: % THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS % IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,% THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR % PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR % CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, % EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, % PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR % PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF % LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING % NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS % SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.%% Function implementationfunction ROI = roireadenvi(roiFile)% Open Filefid = fopen(roiFile);% Get ROI header informationROI = ''; % Initialize Structtest = [];while isempty(test)    fline = fgetl(fid);    % find number of ROIs     test = find(strncmp('; Number of', fline, 11));    % test = strmatch('; Number of',fline); endROI.('NumROI') = str2double(strtrim(fline(strfind(fline,':')+1:end)));test = [];% For each ROI, get associated infofor count = 1:ROI.NumROI    while isempty(test)        fline = fgetl(fid);        test = find(strncmp('; ROI name', fline, 10));       % test = strmatch('; ROI name',fline);    end    ROIName = strtrim(fline(strfind(fline,':')+1:end));    fline = fgetl(fid);    ROIcolor = str2double(strtrim(fline(strfind(fline,'{')+1:end-1)));    fline = fgetl(fid);    ROI_numPts = strtrim(fline(strfind(fline,':')+1:end));    % Dynamically expand struct and assign ROI information to cell    % fields    ROIcnt = ['R' num2str(count)]; % Each independent ROI name assigned    ROI.(ROIcnt).('Name') = ROIName;    ROI.(ROIcnt).('Color') = ROIcolor;    ROI.(ROIcnt).('numPts') = str2double(ROI_numPts);    test = [];end% Get the ROI Points for each ROI% Advance to the start of the ROI points%     while isempty(test)fline = fgetl(fid);%         test = strmatch(';   ID',fline);%     end% Get number of bands in ROINumBands = length(find(fline == 'B'));% Add 3 fields to num bands to account for ROI point ID and the% x,y coordinates (see ROI ASCII file).NumBands = NumBands + 3;% For each ROI, get the associative ROI pointsfor count = 1:ROI.NumROI    ROIcnt = ['R' num2str(count)];    ROI.(ROIcnt).('Points') = zeros(ROI.(ROIcnt).numPts,NumBands);    for count2 = 1:ROI.(ROIcnt).numPts        fline = fgetl(fid);        ROI.(ROIcnt).Points(count2,:) = str2double(fline);    end    % fline = fgetl(fid); % skips the blank lineend% Close ROI Filefclose(fid);end##### SOURCE END #####-->  </body></html>