<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>  <head>    <meta content="text/html; charset=utf-8" http-equiv="content-type">    <!--This HTML was auto-generated from MATLAB code.To make changes, update the MATLAB code and republish this document.      -->    <title>CANNYEDGEMAP - Find edge in an image from its directional      derivatives.</title>    <meta name="generator" content="MATLAB 7.14">    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">    <meta name="DC.date" content="2012-05-31">    <meta name="DC.source" content="cannyedgemap.m">    <style type="text/css">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}html { min-height:100%; margin-bottom:1px; }html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }html body td { vertical-align:top; text-align:left; }h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }a { color:#005fce; text-decoration:none; }a:hover { color:#005fce; text-decoration:underline; }a:visited { color:#004aa0; text-decoration:none; }p { padding:0px; margin:0px 0px 20px; }img { padding:0px; margin:0px 0px 20px; border:none; }p img, pre img, tt img, li img { margin-bottom:0px; } ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }ul li { padding:0px; margin:0px 0px 7px 0px; }ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }ul li ol li { list-style:decimal; }ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }ol li ol li { list-style-type:lower-alpha; }ol li ul { padding-top:7px; }ol li ul li { list-style:square; }.content { font-size:1.2em; line-height:140%; padding: 20px; }pre, tt, code { font-size:12px; }pre { margin:0px 0px 20px; }pre.error { color:red; }pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }span.keyword { color:#0000FF }span.comment { color:#228B22 }span.string { color:#A020F0 }span.untermstring { color:#B20000 }span.syscmd { color:#B28C00 }.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }.footer p { margin:0px; }  </style>  </head>  <body>    <div class="content">      <h1>CANNYEDGEMAP - Find edge in an image from its directional derivatives.</h1>      <!--introduction--><!--/introduction-->      <h2>Contents</h2>      <div>        <ul>          <li><a href="#1">Description</a></li>          <li><a href="#2">Algorithm</a></li>          <li><a href="#3">Syntax</a></li>          <li><a href="#4">Inputs</a></li>          <li><a href="#5">Property [propertyname propertyvalues]</a></li>          <li><a href="#6">Output</a></li>          <li><a href="#7">Acknowledgment</a></li>          <li><a href="#8">References</a></li>          <li><a href="#10">See also</a></li>          <li><a href="#11">Function implementation</a></li>        </ul>      </div>      <h2>Description<a name="1"></a></h2>      <p>This function finds edges in a image, given its directional        derivatives, and possibly the magnitude/orientation images. It is        nothing else than Canny's approach [Canny86] (non-maxima suppression +        hystheresis thresholding) applied on already estimated derivatives.</p>      <h2>Algorithm<a name="2"></a></h2>      <p>The Canny method finds edges by looking for local maxima of mag given        as input. The method uses two thresholds, to detect strong and weak        edges, and includes the weak edges in the output only if they are        connected to strong edges. This method is therefore less likely than the        others to be "fooled" by noise, and more likely to detect true weak        edges.</p>      <h2>Syntax<a name="3"></a></h2>      <pre>   map = CANNYEDGEMAP(gx,gy);   map = CANNYEDGEMAP(gx,gy,'propertyname',propertyvalue,...)</pre>      <h2>Inputs<a name="4"></a></h2>      <p><b><tt>gx, gy</tt></b> : directional derivatives of an image in X-        (horizontal) and Y- (vertical) directions, typically estimated by        differentiating the Gaussian filter of an image; see <tt>GRDSMOOTH</tt>        for discussion regarding the direction/orientation of the gradient        derivatives.</p>      <h2>Property [propertyname propertyvalues]<a name="5"></a></h2>      <p><b><tt>'mag'</tt></b> : a matrix storing typically the image gradient        magnitude or the norm of the gradient structure tensor; if not parsed,        it is the norm of the <tt>[gx,gy]</tt> gradient field (and possibly        taking the max over the different channels if the gradient is 3D: see <tt>CANNYEDGES</tt>).</p>      <p><b><tt>'or'</tt></b> : image containing feature normal orientation        angles in degrees (0-180), angles positive anti-clockwise.</p>      <p><b><tt>'der'</tt></b> : string setting the name of the function used        for Canny edge detection; it can be:</p>      <div>        <ul>          <li><tt>'vista'</tt> for the function <tt>CANNYEDGES</tt> used in            Radius project,</li>          <li><tt>'edge'</tt> (or <tt>'matlab'</tt>) for the standard <tt>EDGE</tt>            detection implemented in matlab (the same with <tt>nbin=64</tt>            instead of 128 when estimating automatically the threshold values),</li>          <li><tt>'kovesi'</tt> for the functions <tt>NONMAXSUP</tt> snd <tt>HYSTTHRES</tt>            implemented by P.Kovesi [Kovesi];</li>        </ul>      </div>      <p>default: <tt>der='edge'</tt>.</p>      <p><b><tt>'hyst'</tt></b> : vector <tt>[low high]</tt> setting the low        and high hystheresis threshold values with <tt>0&lt;=low&lt;high&lt;1</tt>        used with <tt>der='edges'</tt>; default: <tt>hyst=[]</tt>, and the        threshold values are chosen automatically (see <tt>EDGE</tt>) or using        the variable <tt>ratio</tt> below.</p>      <p><b><tt>'ratio'</tt></b> : vector with pixel and threshold ratios used        for automatically selecting the hysteresis thresholds when those are not        passed; default: <tt>ratio = [pixratio threshratio] = [1/3 0.08]</tt>.</p>      <h2>Output<a name="6"></a></h2>      <p><b><tt>map</tt></b> : binary edge map with non maximally suppressed        image.</p>      <h2>Acknowledgment<a name="7"></a></h2>      <p>This function is a copy/paste and crop of several proposed functions        implemented for thresholding, non maximum suppression and thinning of        edge maps.</p>      <h2>References<a name="8"></a></h2>      <p>[Canny86] J.F. Canny: "A computational approach to edge detection",        IEEE Trans. on Pattern Analysis and Machine Intelligence, 8(6):679-698,        1986. <a href="http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=4767851&amp;tag=1">http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=4767851&amp;tag=1</a></p>      <p>[Kovesi] P.D. Kovesi: "MATLAB and Octave Functions for Computer Vision        and Image Processing", The University of Western Australia. <a href="http://www.csse.uwa.edu.au/%7Epk/research/matlabfns/">http://www.csse.uwa.edu.au/~pk/research/matlabfns/</a></p>      <h2>See also<a name="10"></a></h2>      <p>Related: <a href="CANNYEDGE.html"><tt>CANNYEDGE</tt></a>, <a href="EDGECORNER.html"><tt>EDGECORNER</tt></a>,        <a href="../../../vista/html/CANNYEDGES.html"><tt>CANNYEDGES</tt></a>,        Called: <a href="CANNYEDGEMAP_BASE.html"><tt>CANNYEDGEMAP_BASE</tt></a>.</p>      <h2>Function implementation<a name="11"></a></h2>      <pre class="codeinput"><span class="keyword">function</span> map = cannyedgemap(gx,gy,varargin)</pre>      <p>parsing and checking parameters</p>      <pre class="codeinput">error(nargchk(1, 20, nargin, <span class="string">'struct'</span>));error(nargoutchk(1, 1, nargout, <span class="string">'struct'</span>));<span class="keyword">if</span> ~(isnumeric(gx) &amp;&amp; isnumeric(gy))    error(<span class="string">'cannyedgemap:inputparameter'</span>,<span class="string">'matrices required in input'</span>);<span class="keyword">elseif</span> ~isequal(size(gx),size(gy))    error(<span class="string">'cannyedgemap:inputparameter'</span>, <span class="keyword">...</span>        <span class="string">'input matrices with same size required in input'</span>);<span class="keyword">end</span>p = createParser(<span class="string">'CANNYEDGEMAP'</span>);   <span class="comment">% create an instance of the inputParser class.</span><span class="comment">% function handling the function used for estimating Canny edges</span>p.addParamValue(<span class="string">'mag'</span>, [],  @(x)isfloat(x));p.addParamValue(<span class="string">'or'</span>, [], @(x)isfloat(x));p.addParamValue(<span class="string">'der'</span>, <span class="string">'matlab'</span>, @(x)ischar(x) &amp;&amp; <spanclass="keyword">...</span>    any(strcmpi(x,{<span class="string">'vista'</span>,<span class="string">'edge'</span>,<spanclass="string">'matlab'</span>,<spanclass="string">'kovesi'</span>})));p.addParamValue(<span class="string">'hyst'</span>, [], <span class="keyword">...</span>    @(x)isvector(x) &amp;&amp; length(x)&lt;=2 &amp;&amp; all(x&gt;=0) &amp;&amp; all(x&lt;1));p.addParamValue(<span class="string">'ratio'</span>, [1/3 0.08], <span class="keyword">...</span>    @(x)isvector(x) &amp;&amp; length(x)==2 &amp;&amp; all(x&gt;=0) &amp;&amp; all(x&lt;1));<span class="comment">% parse and validate all input arguments</span>p.parse(varargin{:});p = getvarParser(p);</pre>      <p>main computation</p>      <pre class="codeinput">map = cannyedgemap_base(gx, gy, p.der, p.mag, p.or, p.hyst, p.ratio);</pre>      <p>display</p>      <pre class="codeinput"><span class="keyword">if</span> p.disp    figure, imagesc(edgemap), axis <span class="string">image</span> <span class="string">off</span>, title(<spanclass="string">'edge map'</span>);    <span class="keyword">if</span> size(edgemap,3) == 1, colormap <span class="string">'gray'</span>; <spanclass="keyword">end</span>;<span class="keyword">end</span></pre>      <pre class="codeinput"><span class="keyword">end</span>  <span class="comment">% end of cannyedgemap</span></pre></div>    <!--##### SOURCE BEGIN #####%% CANNYEDGEMAP - Find edge in an image from its directional derivatives.%%% Description% This function finds edges in a image, given its directional derivatives,% and possibly the magnitude/orientation images. It is nothing else than% Canny's approach [Canny86] (non-maxima suppression + hystheresis% thresholding) applied on already estimated derivatives.%%% Algorithm% The Canny method finds edges by looking for local maxima of mag given as% input. The method uses two thresholds, to detect strong and weak edges,% and includes the weak edges in the output only if they are connected to % strong edges. This method is therefore less likely than the others to be % "fooled" by noise, and more likely to detect true weak edges.%%% Syntax%     map = CANNYEDGEMAP(gx,gy);%     map = CANNYEDGEMAP(gx,gy,'propertyname',propertyvalue,...)%%% Inputs% *|gx, gy|* : directional derivatives of an image in X- (horizontal) and Y- %     (vertical) directions, typically estimated by differentiating the%     Gaussian filter of an image; see |GRDSMOOTH| for discussion regarding%     the direction/orientation of the gradient derivatives.%%% Property [propertyname  propertyvalues]% *|'mag'|* : a matrix storing typically the image gradient magnitude or the%     norm of the gradient structure tensor; if not parsed, it is the norm%     of the |[gx,gy]| gradient field (and possibly taking the max over the%     different channels if the gradient is 3D: see |CANNYEDGES|). %% *|'or'|* : image containing feature normal orientation angles in degrees%     (0-180), angles positive anti-clockwise.%% *|'der'|* : string setting the name of the function used for Canny edge%     detection; it can be:%% * |'vista'| for the function |CANNYEDGES| used in Radius project,% * |'edge'| (or |'matlab'|) for the standard |EDGE| detection%          implemented in matlab (the same with |nbin=64| instead of 128 when %          estimating automatically the threshold values),% * |'kovesi'| for the functions |NONMAXSUP| snd |HYSTTHRES| implemented %           by P.Kovesi [Kovesi];%% default: |der='edge'|.%% *|'hyst'|* : vector |[low high]| setting the low and high hystheresis threshold %     values with |0<=low<high<1| used with |der='edges'|; default: |hyst=[]|, %     and the threshold values are chosen automatically (see |EDGE|) or using%     the variable |ratio| below.%% *|'ratio'|* : vector with pixel and threshold ratios used for automatically%     selecting the hysteresis thresholds when those are not passed;%     default: |ratio = [pixratio threshratio] = [1/3 0.08]|.%%% Output% *|map|* : binary edge map with non maximally suppressed image.%%% Acknowledgment% This function is a copy/paste and crop of several proposed functions % implemented for thresholding, non maximum suppression and thinning of% edge maps.%%% References% [Canny86]  J.F. Canny: "A computational approach to edge detection",%      IEEE Trans. on Pattern Analysis and Machine Intelligence, 8(6):679-698,%      1986.%      <http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=4767851&tag=1>% % [Kovesi]   P.D. Kovesi: "MATLAB and Octave Functions for Computer Vision%      and Image Processing", The University of Western Australia.%      <http://www.csse.uwa.edu.au/~pk/research/matlabfns/>%%% Credit% <mailto:prasad@lanl.gov L.Prasad> & <mailto:grazzja@lanl.gov J.Grazzini> (ISR-2/LANL)%%% See also% Related:% <CANNYEDGE.html |CANNYEDGE|>,% <EDGECORNER.html |EDGECORNER|>,% <../../../vista/html/CANNYEDGES.html |CANNYEDGES|>,% Called:% <CANNYEDGEMAP_BASE.html |CANNYEDGEMAP_BASE|>. %% Function implementationfunction map = cannyedgemap(gx,gy,varargin)%%% parsing and checking parameterserror(nargchk(1, 20, nargin, 'struct'));error(nargoutchk(1, 1, nargout, 'struct'));if ~(isnumeric(gx) && isnumeric(gy))    error('cannyedgemap:inputparameter','matrices required in input'); elseif ~isequal(size(gx),size(gy))    error('cannyedgemap:inputparameter', ...        'input matrices with same size required in input'); endp = createParser('CANNYEDGEMAP');   % create an instance of the inputParser class.% function handling the function used for estimating Canny edgesp.addParamValue('mag', [],  @(x)isfloat(x));p.addParamValue('or', [], @(x)isfloat(x));p.addParamValue('der', 'matlab', @(x)ischar(x) && ...    any(strcmpi(x,{'vista','edge','matlab','kovesi'})));p.addParamValue('hyst', [], ...    @(x)isvector(x) && length(x)<=2 && all(x>=0) && all(x<1));p.addParamValue('ratio', [1/3 0.08], ...    @(x)isvector(x) && length(x)==2 && all(x>=0) && all(x<1));% parse and validate all input argumentsp.parse(varargin{:});p = getvarParser(p);                                                            %%% main computationmap = cannyedgemap_base(gx, gy, p.der, p.mag, p.or, p.hyst, p.ratio);%%% displayif p.disp    figure, imagesc(edgemap), axis image off, title('edge map');    if size(edgemap,3) == 1, colormap 'gray'; end;endend  % end of cannyedgemap##### SOURCE END #####-->  </body></html>