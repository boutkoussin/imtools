<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html>  <head>    <meta content="text/html; charset=utf-8" http-equiv="content-type">    <!--This HTML was auto-generated from MATLAB code.To make changes, update the MATLAB code and republish this document.      -->    <title>AMOEBASUPERPIX - Amoeba-like superpixel segmentation.</title>    <meta name="generator" content="MATLAB 7.14">    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">    <meta name="DC.date" content="2012-11-29">    <meta name="DC.source" content="amoebasuperpix.m">    <style type="text/css">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}html { min-height:100%; margin-bottom:1px; }html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }html body td { vertical-align:top; text-align:left; }h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }a { color:#005fce; text-decoration:none; }a:hover { color:#005fce; text-decoration:underline; }a:visited { color:#004aa0; text-decoration:none; }p { padding:0px; margin:0px 0px 20px; }img { padding:0px; margin:0px 0px 20px; border:none; }p img, pre img, tt img, li img { margin-bottom:0px; } ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }ul li { padding:0px; margin:0px 0px 7px 0px; }ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }ul li ol li { list-style:decimal; }ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }ol li ol li { list-style-type:lower-alpha; }ol li ul { padding-top:7px; }ol li ul li { list-style:square; }.content { font-size:1.2em; line-height:140%; padding: 20px; }pre, tt, code { font-size:12px; }pre { margin:0px 0px 20px; }pre.error { color:red; }pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }span.keyword { color:#0000FF }span.comment { color:#228B22 }span.string { color:#A020F0 }span.untermstring { color:#B20000 }span.syscmd { color:#B28C00 }.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }.footer p { margin:0px; }  </style>  </head>  <body>    <div class="content">      <h1>AMOEBASUPERPIX - Amoeba-like superpixel segmentation.</h1>      <!--introduction--><!--/introduction-->      <h2>Contents</h2>      <div>        <ul>          <li><a href="#1">Description</a></li>          <li><a href="#2">Syntax</a></li>          <li><a href="#3">Inputs</a></li>          <li><a href="#4">Property [propertyname propertyvalues]</a></li>          <li><a href="#5">Outputs</a></li>          <li><a href="#6">References</a></li>          <li><a href="#8">See also</a></li>          <li><a href="#9">Function implementation</a></li>        </ul>      </div>      <h2>Description<a name="1"></a></h2>      <p>Compute superpixel regions using an algorithm based on the estimation        of local amoeba-like neighborhoods. This approach is similar to the        Simple Linear Iterative Clustering superpixel segmentation technique of        [ASSLFS10,LSALF10] and introducing a distance derived from the amoeba        construction in [LDM0709]. It performs a kmeans-based clustering for a        selected number of seeds that outputs superpixel regions as amoeba        neighbourhoods [LDM0709,GS08].</p>      <h2>Syntax<a name="2"></a></h2>      <pre>  Q = AMOEBASUPERPIX(I);  [Q, Ck, ColCk] = AMOEBASUPERPIX(I, K0, 'Property', propertyvalue, ... );</pre>      <h2>Inputs<a name="3"></a></h2>      <p><b><tt>I</tt></b> : input color image of size <tt>(X,Y,C)</tt>        (multispectral with <tt>C=3</tt> bands).</p>      <p><b><tt>K0</tt></b> : desired number of clusters, ie. of approximately        equally-sized superpixels.</p>      <h2>Property [propertyname propertyvalues]<a name="4"></a></h2>      <p><b><tt>'thres'</tt></b> : (optional) stopping criterion; it is defined        as a threshold on the error for relocating all the superpixel regions'        centers; default: <tt>thres=eps</tt>.</p>      <p><b><tt>'alpha'</tt></b> : (optional) vector of dimension <tt>(1,n)</tt>        with <tt>n</tt>=1 or 2 providing the influence factors used when        propagating the amoeba superpixels; it quantifies the relative        influences of the spectral proximity w.r.t the spatial one (simply        computed as the local Euclidean distance) in the calculation of the        perceptual distance measure; <tt>alpha(1)</tt> is a scalar used to        amplify (multiply) the spectral (graylevel or color) influence (the        higher it is, the more spectral closeness is emphasized), <tt>alpha(2)</tt>        is a scalar used to introduce a factor based on the gradient magnitude        (the higher it is, the less probable amoeba superpixels will cross        regions of high gradient); note that the higher <tt>alpha(1)</tt>        and/or <tt>alpha(2)</tt>, the less compact the clusters are; default: <tt>alpha=[1
          0]</tt>.</p>      <p><b><tt>'n'</tt></b> : (optional) multiplying factor used for the search        area around each superpixel region's center; default: <tt>n=2</tt>.</p>      <p><b><tt>'k'</tt></b> : (optional) size of the neighbourood considered        when correcting the location of the superpixel regions' centers; when        set to 0, the first initial initialization is kept as it is; default: <tt>k=3</tt>.</p>      <p><b><tt>'iter'</tt></b> : (optional) maximum number of iterations;        default: <tt>iter=Inf</tt>, ie. the segmentation process is iterated        till convergence.</p>      <p><b><tt>'lab'</tt></b> : (optional) boolean flag set to true for        transforming, prior to the processing, a 3D image (assumed to be RGB)        into the Lab color space; default: <tt>lab=false</tt>.</p>      <h2>Outputs<a name="5"></a></h2>      <p><b><tt>Q</tt></b> : diagram of amoeba superpixels regions; it takes        values in the range <tt>[1,K]</tt> where <tt>K</tt> is the final        number of superpixel regions; it is a matrix of size <tt>(X,Y)</tt>.</p>      <p><b><tt>Ck</tt></b> : coordinates of the centers of the corresponding        superpixels; it is a matrix of size <tt>(K,2)</tt>.</p>      <p><b><tt>ColCk</tt></b> : representative color values of the superpixels;        it is a matrix of size <tt>(K,3)</tt>.</p>      <h2>References<a name="6"></a></h2>      <p>[LDM0709] R. Lerallut, E. Decenciere, and F. Meyer: "Image filtering        using morphological amoebas", Image and Vision Computing, 25(4):395-404,        2007. <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.106.1413">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.106.1413</a></p>      <p>[GS08] J. Grazzini and P. Soille: "Adaptive morphological filters using        similarities based on geodesic time", Proc. DGCI, LNCS, vol. 4992, pp.        519-528, 2008. <a href="http://www.springerlink.com/content/f6v62233xqkklq72/">http://www.springerlink.com/content/f6v62233xqkklq72/</a></p>      <p>[GSD10] J. Grazzini, P. Soille and S. Dillard: "Multichannel image        regularisation using anisotropic geodesic filtering", Proc. ICPR, pp.        2664-2667, 2010. <a href="http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=5596008">http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=5596008</a></p>      <p>[ASSLFS10] R. Achanta, A. Shaji, K. Smith, A. Lucchi, P. Fua and S.        Susstrunk: "SLIC superpixels", EPFL Technical Report no. 149300, 2010. <a          href="http://infoscience.epfl.ch/record/149300/files/SLIC_Superpixels_TR_2.pdf">http://infoscience.epfl.ch/record/149300/files/SLIC_Superpixels_TR_2.pdf</a></p>      <p>[LSALF10] A. Lucchi, K. Smith, R. Achanta, V. Lepetit and P. Fua: "A        fully automated approach to segmentation of irregularly shaped cellular        structures in EM images", pp. 463-471, Proc. MICCAI, 2010. <a href="http://cvlab.epfl.ch/publications/publications/2010/LucchiSALF10.pdf">http://cvlab.epfl.ch/publications/publications/2010/LucchiSALF10.pdf</a></p>      <h2>See also<a name="8"></a></h2>      <p>Ressembles: <a href="slicsuperpix.html"><tt>SLICSUPERPIX</tt></a>, <a          href="geosuperpix.html"><tt>GEOSUPERPIX</tt></a>,        <a href="../propagation/fmm.html"><tt>FMM</tt></a>. Requires: <a href="amoebasuperpix_base.html"><tt>AMOEBASUPERPIX_BASE</tt></a>.</p>      <h2>Function implementation<a name="9"></a></h2>      <pre class="codeinput"><span class="keyword">function</span> [Q, varargout] = amoebasuperpix(I, varargin )</pre>      <p>parsing parameters</p>      <pre class="codeinput">narginchk(1, 23);nargoutchk(1, 3);<span class="comment">% mandatory parameter</span><span class="keyword">if</span> ~isnumeric(I)    error(<span class="string">'amoebasuperpix:inputerror'</span>,<span class="string">'a matrix is required in input'</span>);<span class="keyword">end</span><span class="comment">% optional parameters</span>p = createParser(<span class="string">'AMOEBASUPERPIX'</span>);   <span class="comment">% create an instance of the inputParser class.</span>p.addOptional(<span class="string">'K'</span>, 0.1, @(x)isscalar(x) &amp;&amp; ((x&gt;0 &amp;&amp; x&lt;1) || (x&gt;1 &amp;&amp; x==round(x))));<span class="comment">% additional optional parameters</span>p.addParamValue(<span class="string">'alpha'</span>, [1 0], @(x) all(x&gt;=0) &amp;&amp; (isscalar(x) || <spanclass="keyword">...</span>    (isnumeric(x) &amp;&amp; length(x)&lt;=2)));p.addParamValue(<span class="string">'thres'</span>, eps, @(x) isscalar(x) &amp;&amp; x&gt;=0);p.addParamValue(<span class="string">'n'</span>, 2, @(x)isscalar(x) &amp;&amp; x&gt;=1 &amp;&amp; x==round(x));p.addParamValue(<span class="string">'k'</span>, 0, @(x)isscalar(x) &amp;&amp; (x==0 || x&gt;=3));p.addParamValue(<span class="string">'iter'</span>, Inf, @(x)isscalar(x) &amp;&amp; x&gt;=1);p.addParamValue(<span class="string">'lab'</span>, false, @islogical);<span class="comment">% additional parameters used by IM2POTENTIAL_BASE</span><span class="comment">% parse and validate all input arguments</span>p.parse(varargin{:});p = getvarParser(p);</pre>      <p>setting variables</p>      <pre class="codeinput"><span class="keyword">if</span> size(I,3)~=3 &amp;&amp; p.lab    warning(<span class="string">'amoebasuperpix:inputwarning'</span>, <span class="keyword">...</span>        <span class="string">'option lab available for RGB and 3 vectorial image only'</span>);    p.lab = false;<span class="keyword">end</span><span class="keyword">if</span> p.K&lt;1    p.K = p.K * min(size(I,1),size(I,2)); <span class="comment">% proportion</span><span class="keyword">end</span><span class="comment">% fill p.alpha with 0's</span><span class="keyword">if</span> length(p.alpha)&lt;2,  p.alpha = [p.alpha 0];  <spanclass="keyword">end</span></pre>      <p>main computation</p>      <pre class="codeinput">[Q, Ck, ColCk] = amoebasuperpix_base(I, p.K, <spanclass="keyword">...</span>    p.lab, p.alpha, p.thres, p.n, p.k, p.iter);<span class="keyword">if</span> any(~Q(:))    i = find(~Q);    warning(<span class="string">'amoebasuperpix:outputwarning'</span>, <span class="keyword">...</span>        [<span class="string">'not all pixels reached by the classifier - '</span> <spanclass="keyword">...</span>        <span class="string">'increase the range of the exploration domain (''n'') '</span> <spanclass="keyword">...</span>        <span class="string">'or, when possible, the number of iterations (''iter'')'</span>]);    Q(i) = 1;<span class="keyword">end</span><span class="keyword">if</span> nargout&gt;=2    varargout{1} = Ck;    <span class="keyword">if</span> nargout&gt;=3,  varargout{2} = ColCk;  <spanclass="keyword">end</span><span class="keyword">end</span></pre>      <p>display</p>      <pre class="codeinput"><span class="keyword">if</span> p.disp    figure;    <span class="keyword">if</span> isempty(ver(<span class="string">'images'</span>))        subplot(1,2,1), imagesc(rescale(I));        subplot(1,2,2), imagesc(Q), colormap <span class="string">jet</span>;    <span class="keyword">else</span>        M = (imdilate(Q,ones(3,3))-Q==0);        subplot(1,2,2), imagesc(label2rgb(Q.*M)), axis <span class="string">image</span> <spanclass="string">off</span>;        M = cat(3,M,M,M);        subplot(1,2,1), imagesc(rescale(I.*M)+(1-M)), axis <span class="string">image</span> <spanclass="string">off</span>;    <span class="keyword">end</span>    suptitle(<span class="string">'amoeba superpixel regions'</span>);    figure;    subplot(1,2,1), imagesc(rescale(I)), axis <span class="string">image</span> <spanclass="string">off</span>;    <span class="keyword">if</span> p.lab,  ColCk = Lab2RGB(ColCk(:,1),ColCk(:,2),ColCk(:,3));  <spanclass="keyword">end</span>    ColCk = double(reshape(ColCk(Q(:),:), size(I)));    <span class="keyword">if</span> exist(<span class="string">'i'</span>,<spanclass="string">'var'</span>),  ColCk([i; i+numel(Q); i+2*numel(Q)]) = 0;  <spanclass="keyword">end</span>    subplot(1,2,2), imagesc(rescale(ColCk)), axis <span class="string">image</span> <spanclass="string">off</span>;    suptitle(<span class="string">'amoeba superpixel approximation'</span>);<span class="keyword">end</span></pre>      <pre class="codeinput"><span class="keyword">end</span> <span class="comment">% end of amoebasuperpix</span></pre></div>    <!--##### SOURCE BEGIN #####%% AMOEBASUPERPIX - Amoeba-like superpixel segmentation.%%% Description % Compute superpixel regions following the approach of [GP12a]. This approach% is similar to the Simple Linear Iterative Clustering superpixel segmentation% technique of [ASSLFS10,LSALF10] and introducing a distance derived from the% amoeba construction in [LDM0709]. It performs a kmeans-based clustering % for a selected number of seeds that outputs superpixel regions as amoeba% neighbourhoods [LDM0709,GS08]. %%% Syntax%    Q = AMOEBASUPERPIX(I);%    [Q, Ck, ColCk] = AMOEBASUPERPIX(I, K0, 'Property', propertyvalue, ... );%%% Inputs% *|I|* : input color image of size |(X,Y,C)| (multispectral with |C=3| bands).%% *|K0|* : desired number of clusters, ie. of approximately equally-sized%     superpixels.% %% Property [propertyname  propertyvalues]% *|'thres'|* : (optional) stopping criterion; it is defined as a threshold on%     the error for relocating all the superpixel regions' centers; default:%     |thres=eps|.%% *|'alpha'|* : (optional) vector of dimension |(1,n)| with |n|=1 or 2 providing%     the influence factors used when propagating the amoeba superpixels; it%     quantifies the relative influences of the spectral proximity w.r.t the%     spatial one (simply computed as the local Euclidean distance) in the  %     calculation of the perceptual distance measure; |alpha(1)| is a scalar%     used to amplify (multiply) the spectral (graylevel or color) influence %     (the higher it is, the more spectral closeness is emphasized), |alpha(2)|%     is a scalar used to introduce a factor based on the gradient magnitude %     (the higher it is, the less probable amoeba superpixels will cross %     regions of high gradient); note that the higher |alpha(1)| and/or |alpha(2)|,%     the less compact the clusters are; default: |alpha=[1 0]|. %% *|'n'|* : (optional) multiplying factor used for the search area around each%     superpixel region's center; default: |n=2|.%% *|'k'|* : (optional) size of the neighbourood considered when correcting the%     location of the superpixel regions' centers; when set to 0, the first%     initial initialization is kept as it is; default: |k=3|.%% *|'iter'|* : (optional) maximum number of iterations; default: |iter=Inf|,%     ie. the segmentation process is iterated till convergence.%% *|'lab'|* : (optional) boolean flag set to true for transforming, prior to%     the processing, a 3D image (assumed to be RGB) into the Lab color%     space; default: |lab=false|.%%% Outputs% *|Q|* : diagram of amoeba superpixels regions; it takes values in the range%     |[1,K]| where |K| is the final number of superpixel regions; it is a%     matrix of size |(X,Y)|.%% *|Ck|* : coordinates of the centers of the corresponding superpixels; it is%     a matrix of size |(K,2)|.%% *|ColCk|* : representative color values of the superpixels; it is a matrix%     of size |(K,3)|.% %% References% [LDM0709]  R. Lerallut, E. Decenciere, and F. Meyer: "Image filtering using%      morphological amoebas", Image and Vision Computing, 25(4):395-404, 2007.%      <http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.106.1413>%% [GS08]  J. Grazzini and P. Soille: "Adaptive morphological filters using %      similarities based on geodesic time", Proc. DGCI, LNCS, vol. 4992, pp.%      519-528, 2008.%      <http://www.springerlink.com/content/f6v62233xqkklq72/>%% [GSD10]  J. Grazzini, P. Soille and S. Dillard: "Multichannel image %      regularisation using anisotropic geodesic filtering", Proc. ICPR,%      pp. 2664-2667, 2010.%      <http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=5596008>%% [ASSLFS10]  R. Achanta, A. Shaji, K. Smith, A. Lucchi, P. Fua and S. %      Susstrunk: "SLIC superpixels", EPFL Technical Report no. 149300, 2010.%      <http://infoscience.epfl.ch/record/149300/files/SLIC_Superpixels_TR_2.pdf>%% [LSALF10]  A. Lucchi, K. Smith, R. Achanta, V. Lepetit and P. Fua: "A %      fully automated approach to segmentation of irregularly shaped cellular%      structures in EM images", pp. 463-471, Proc. MICCAI, 2010. %      <http://cvlab.epfl.ch/publications/publications/2010/LucchiSALF10.pdf>%%% Credit% <mailto:jacopo.grazzini@jrc.ec.europa.eu J.Grazzini> (DERD/JRC)%%% See also% Ressembles:% <slicsuperpix.html |SLICSUPERPIX|>,% <geosuperpix.html |GEOSUPERPIX|>,% <../propagation/fmm.html |FMM|>.% Requires:% <amoebasuperpix_base.html |AMOEBASUPERPIX_BASE|>.%% Function implementationfunction [Q, varargout] = amoebasuperpix(I, varargin )%%% parsing parametersnarginchk(1, 23);nargoutchk(1, 3);% mandatory parameterif ~isnumeric(I)    error('amoebasuperpix:inputerror','a matrix is required in input'); end% optional parametersp = createParser('AMOEBASUPERPIX');   % create an instance of the inputParser class.p.addOptional('K', 0.1, @(x)isscalar(x) && ((x>0 && x<1) || (x>1 && x==round(x))));% additional optional parametersp.addParamValue('alpha', [1 0], @(x) all(x>=0) && (isscalar(x) || ...    (isnumeric(x) && length(x)<=2)));p.addParamValue('thres', eps, @(x) isscalar(x) && x>=0);p.addParamValue('n', 2, @(x)isscalar(x) && x>=1 && x==round(x));p.addParamValue('k', 0, @(x)isscalar(x) && (x==0 || x>=3));p.addParamValue('iter', Inf, @(x)isscalar(x) && x>=1);p.addParamValue('lab', false, @islogical);% additional parameters used by IM2POTENTIAL_BASE% parse and validate all input argumentsp.parse(varargin{:}); p = getvarParser(p); %% % setting variablesif size(I,3)~=3 && p.lab    warning('amoebasuperpix:inputwarning', ...        'option lab available for RGB and 3 vectorial image only');    p.lab = false;endif p.K<1    p.K = p.K * min(size(I,1),size(I,2)); % proportionend% fill p.alpha with 0'sif length(p.alpha)<2,  p.alpha = [p.alpha 0];  end%%% main computation    [Q, Ck, ColCk] = amoebasuperpix_base(I, p.K, ...    p.lab, p.alpha, p.thres, p.n, p.k, p.iter);if any(~Q(:))    i = find(~Q);    warning('amoebasuperpix:outputwarning', ...        ['not all pixels reached by the classifier - ' ...        'increase the range of the exploration domain (''n'') ' ...        'or, when possible, the number of iterations (''iter'')']);    Q(i) = 1;endif nargout>=2    varargout{1} = Ck;    if nargout>=3,  varargout{2} = ColCk;  endend%%% displayif p.disp    figure;    if isempty(ver('images'))        subplot(1,2,1), imagesc(rescale(I));        subplot(1,2,2), imagesc(Q), colormap jet;    else        M = (imdilate(Q,ones(3,3))-Q==0);        subplot(1,2,2), imagesc(label2rgb(Q.*M)), axis image off;        M = cat(3,M,M,M);        subplot(1,2,1), imagesc(rescale(I.*M)+(1-M)), axis image off;    end    suptitle('amoeba superpixel regions');    figure;    subplot(1,2,1), imagesc(rescale(I)), axis image off;    if p.lab,  ColCk = Lab2RGB(ColCk(:,1),ColCk(:,2),ColCk(:,3));  end    ColCk = double(reshape(ColCk(Q(:),:), size(I)));    if exist('i','var'),  ColCk([i; i+numel(Q); i+2*numel(Q)]) = 0;  end    subplot(1,2,2), imagesc(rescale(ColCk)), axis image off;    suptitle('amoeba superpixel approximation');endend % end of amoebasuperpix##### SOURCE END #####-->  </body></html>